!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PardusFlightComputer=e():t.PardusFlightComputer=e()}(self,()=>(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{default:()=>ot});class s{#t;constructor(t=""){if(""===t)throw"Page is not defined for class";this.#t=t}toString(){return this.#t}navigateTo(){document.location.assign(`${document.location.origin}${this.#t}`)}isActive(){return document.location.pathname===this.#t}}class i{#e;#s;#i;#o;#r=new Set;#a=new Set;static colours=new Map([["Green",{red:0,green:128,blue:0,short_code:"g"}],["Blue",{red:0,green:0,blue:128,short_code:"b"}],["Red",{red:128,green:0,blue:0,short_code:"r"}],["Yellow",{red:128,green:128,blue:0,short_code:"y"}],["Cyan",{red:0,green:128,blue:128,short_code:"c"}],["Magenta",{red:128,green:0,blue:128,short_code:"m"}],["Silver",{red:128,green:128,blue:128,short_code:"s"}]]);constructor(t,e,s,i=null,o=!1){if(this.#e=e,this.#s=s,this.emphasised=!1,this.path_highlighted=!1,this.#o=o,this.type="regular",this.objectType="",this.isVirtualTile())this.#i=i.toString();else{this.element=t,this.background_image=this.element.style.backgroundImage;const e=/^\s*linear-gradient.*?, (url\(.*)$/;if(e.test(this.background_image)&&(this.background_image=this.background_image.match(e)[1]),this.element.classList.contains("navNpc")&&(this.objectType="npc"),this.element.classList.contains("navBuilding")&&(this.objectType="building"),this.element.classList.contains("navWormhole")&&(this.type="wormhole"),this.element.classList.contains("navYhole")&&(this.type="y-hole"),this.element.classList.contains("navXhole")&&(this.type="x-hole"),this.element.classList.contains("navShip")&&this.element.querySelector("#thisShip"))this.#i=this.getUserloc();else if(this.element.children.length>0&&this.element.querySelector("A")){const t=this.element.querySelector("A");t.hasAttribute("onclick")&&!t.getAttribute("onclick").startsWith("warp")||t.hasAttribute("_onclick")&&!t.getAttribute("_onclick").startsWith("warp")?t.hasAttribute("onclick")&&t.getAttribute("onclick").startsWith("nav")?this.#i=t.getAttribute("onclick").match(/^[^\d]*(\d*)[^\d]*$/)[1]:t.hasAttribute("_onclick")&&t.getAttribute("_onclick").startsWith("nav")?this.#i=t.getAttribute("_onclick").match(/^[^\d]*(\d*)[^\d]*$/)[1]:t.hasAttribute("_onclick")&&"null"===t.getAttribute("_onclick")&&(this.#i=this.getUserloc()):this.#i=this.getUserloc()}else this.element.classList.contains("navShip")&&(this.#i=this.getUserloc())}}isWormhole(){return"wormhole"===this.type}isXHole(){return"x-hole"===this.type}isYHole(){return"y-hole"===this.type}hasNpc(){return"npc"===this.objectType}set id(t){this.#i=t.toString()}get id(){return this.#i}get x(){return this.#e}get y(){return this.#s}getUserloc(){return"undefined"!=typeof userloc?userloc.toString():"-1"}toString(){return`Tile ${this.#i} [${this.x}, ${this.y}]`}valueOf(){return Number(this.#i)}isVirtualTile(){return this.#o}isClickable(){return!!(!this.isVirtualTile()&&this.#i&&parseInt(this.#i)>0)}isNavigatable(){return!!(!this.isVirtualTile()&&this.element&&this.element.children.length>0&&this.element.querySelector("A")?.getAttribute("onclick")&&this.element.querySelector("A")?.getAttribute("onclick").startsWith("nav")&&this.isClickable())||!!(!this.isVirtualTile()&&this.element&&this.element.children.length>0&&this.element.querySelector("A")?.getAttribute("_onclick")&&this.element.querySelector("A")?.getAttribute("_onclick").startsWith("nav")&&this.isClickable())}isCentreTile(){return this.is_centre_tile}isHighlighted(){return this.#r.size>0}addEventListener(t,e,s={}){s.hasOwnProperty("nonce")&&this.#a.has(s.nonce)||this.isNavigatable()&&(this.element.querySelector("A").addEventListener(t,e,s),s.hasOwnProperty("nonce")&&this.#a.add(s.nonce))}addHighlight(t){this.#r.add(t),this.#n()}addHighlights(t=new Set){t.forEach(t=>{this.#r.add(t)}),this.#n()}removeHighlight(t){this.#r.delete(t),this.#n()}isEmphasised(){return this.emphasised}emphasiseHighlight(){this.emphasised=!0,this.#n()}removeEmphasis(){this.emphasised=!1,this.#n()}clearHighlight(){this.#l()}#n(){if(this.isVirtualTile())return!1;if(0===this.#r.size)return this.#l();const t=this.#d(),e=this.emphasised?.8:.5;this.background_image?this.element.style.backgroundImage=`linear-gradient(to bottom, rgba(${t},${e}), rgba(${t},${e})), `+this.background_image:(this.element.style.backgroundColor=`rgba(${t},1)`,this.element.firstElementChild.style.opacity=1-e)}#l(){return!this.isVirtualTile()&&(this.#r.clear(),this.background_image?this.element.style.backgroundImage=this.background_image:(this.element.style.backgroundColor="",this.element.firstElementChild.style.opacity=1),!0)}*#h(){for(const t of this.constructor.colours.values())this.#r.has(t.short_code)&&(yield{red:t.red,green:t.green,blue:t.blue})}#d(){if(this.isVirtualTile())return!1;let t=0,e=0,s=0,i=0,o=0,r=0;for(const a of this.#h())t+=a.red,e+=a.green,s+=a.blue,i+=1,o+=1,r+=1;return 0===i&&(i=1),0===o&&(o=1),0===r&&(r=1),`${Math.floor(t/i)},${Math.floor(e/o)},${Math.floor(s/r)}`}}class o{#c=0;#u=0;#g=0;constructor(t,e,s,i){this.name=t,this.#c=e,this.#u=s,this.#g=i}contains(t){return t>=this.#c&&t<this.#c+this.#u*this.#g}getTile(t){return this.contains(t)?{sector:this.name,x:Math.floor((t-this.#c)/this.#g),y:(t-this.#c)%this.#g,tile_id:t,rows:this.#g,colums:this.#u}:null}getVirtualTile(t,e,s){return new i(null,t,e,Number(s.id)+(t-s.x)+(e-s.y)*this.#u,!0)}getTileHumanString(t){const e=this.getTile(t);return`${e.sector} [${e.x}, ${e.y}]`}getTileByCoords(t,e){return Number(t)<0||Number(e)<0||Number(t)>=this.#u||Number(e)>=this.#g?-1:Number(this.#c)+Number(t)*Number(this.#g)+Number(e)}}const r={Aandti:{start:78435,cols:22,rows:13},"AB 5-848":{start:375e3,cols:18,rows:14},Abeho:{start:325645,cols:25,rows:13},Achird:{start:118538,cols:22,rows:22},Ackandso:{start:24458,cols:26,rows:20},Ackarack:{start:3e5,cols:14,rows:20},Ackexa:{start:32188,cols:20,rows:15},Ackwada:{start:101525,cols:22,rows:15},Adaa:{start:6409,cols:22,rows:26},Adara:{start:95219,cols:15,rows:21},Aedce:{start:306687,cols:17,rows:20},Aeg:{start:24978,cols:21,rows:13},Alfirk:{start:95534,cols:20,rows:15},Algol:{start:375252,cols:19,rows:25},Alioth:{start:32488,cols:16,rows:15},"Alpha Centauri":{start:1,cols:19,rows:12},"AN 2-956":{start:52083,cols:19,rows:20},"An Dzeve":{start:6981,cols:23,rows:18},Anaam:{start:16466,cols:18,rows:20},Anayed:{start:300280,cols:15,rows:16},Andexa:{start:229,cols:20,rows:15},Andsoled:{start:318960,cols:18,rows:25},Anphiex:{start:78721,cols:18,rows:30},Arexack:{start:325970,cols:17,rows:17},Atlas:{start:79261,cols:21,rows:15},Aveed:{start:101855,cols:17,rows:15},Aya:{start:142998,cols:40,rows:35},Ayargre:{start:16826,cols:18,rows:18},Ayinti:{start:300520,cols:20,rows:20},Ayqugre:{start:307027,cols:16,rows:14},Baar:{start:79576,cols:16,rows:12},Baham:{start:139288,cols:29,rows:36},"BE 3-702":{start:119022,cols:20,rows:20},Becanin:{start:52463,cols:17,rows:14},Becanol:{start:79768,cols:20,rows:25},Bedaho:{start:32728,cols:20,rows:18},Beeday:{start:300920,cols:16,rows:15},Beethti:{start:17150,cols:16,rows:20},Begreze:{start:17470,cols:17,rows:14},Belati:{start:301160,cols:25,rows:16},Bellatrix:{start:119422,cols:25,rows:18},Besoex:{start:25251,cols:13,rows:16},"Beta Hydri":{start:102110,cols:24,rows:20},"Beta Proxima":{start:529,cols:19,rows:19},Betelgeuse:{start:33088,cols:32,rows:22},Betiess:{start:40935,cols:13,rows:16},Beurso:{start:319410,cols:19,rows:25},Bewaack:{start:375727,cols:14,rows:25},"BL 3961":{start:890,cols:20,rows:10},"BL 6-511":{start:80268,cols:24,rows:31},"BQ 3-927":{start:41143,cols:15,rows:15},"BU 5-773":{start:326259,cols:25,rows:8},Cabard:{start:52701,cols:9,rows:22},Canaab:{start:7539,cols:18,rows:13},Canexin:{start:17708,cols:25,rows:25},Canolin:{start:324186,cols:16,rows:15},Canopus:{start:41368,cols:13,rows:22},Capella:{start:33792,cols:19,rows:17},Cassand:{start:25459,cols:13,rows:19},"CC 3-771":{start:301560,cols:20,rows:10},Ceanze:{start:307251,cols:15,rows:17},Cebalrai:{start:119872,cols:21,rows:24},Cebece:{start:140332,cols:27,rows:18},Cegreeth:{start:376077,cols:18,rows:22},Ceina:{start:319885,cols:16,rows:15},Cemiess:{start:52899,cols:18,rows:15},Cesoho:{start:1090,cols:12,rows:7},"Cor Caroli":{start:140818,cols:40,rows:42},"CP 2-197":{start:102590,cols:16,rows:13},Daaya:{start:41654,cols:26,rows:25},Daaze:{start:320125,cols:17,rows:15},Daceess:{start:1174,cols:15,rows:8},Dadaex:{start:326459,cols:18,rows:21},Dainfa:{start:102798,cols:18,rows:18},Datiack:{start:18333,cols:19,rows:15},Daured:{start:103122,cols:18,rows:17},Daurlia:{start:25706,cols:14,rows:15},"Delta Pavonis":{start:25916,cols:14,rows:27},"DH 3-625":{start:110554,cols:16,rows:13},"DI 9-486":{start:103428,cols:25,rows:16},Diphda:{start:95834,cols:20,rows:20},"DP 2-354":{start:301760,cols:16,rows:14},Dsiban:{start:120376,cols:17,rows:17},Dubhe:{start:142498,cols:20,rows:25},Edbeeth:{start:18618,cols:18,rows:15},Edeneth:{start:8273,cols:12,rows:7},Edenve:{start:81012,cols:25,rows:25},Edethex:{start:103828,cols:25,rows:25},Edmial:{start:376473,cols:17,rows:16},Edmize:{start:18888,cols:16,rows:16},Edqueth:{start:320380,cols:17,rows:10},Edvea:{start:301984,cols:32,rows:24},"EH 5-382":{start:96234,cols:14,rows:15},Electra:{start:42304,cols:23,rows:16},Elnath:{start:376745,cols:18,rows:25},Enaness:{start:42672,cols:21,rows:12},Encea:{start:53169,cols:14,rows:15},Enif:{start:138413,cols:35,rows:25},Enioar:{start:307506,cols:21,rows:13},Enwaand:{start:320550,cols:20,rows:22},"Epsilon Eridani":{start:1294,cols:18,rows:32},"Epsilon Indi":{start:34115,cols:20,rows:13},Ericon:{start:1870,cols:15,rows:26},Essaa:{start:34375,cols:11,rows:22},"Eta Cassiopeia":{start:26294,cols:15,rows:35},Etamin:{start:144398,cols:31,rows:24},Exackcan:{start:26819,cols:15,rows:13},Exbeur:{start:53379,cols:25,rows:25},Exinfa:{start:8357,cols:10,rows:20},Exiool:{start:104453,cols:22,rows:19},Faarfa:{start:81637,cols:14,rows:12},Facece:{start:54004,cols:16,rows:23},Fadaphi:{start:377195,cols:25,rows:25},Faedho:{start:307779,cols:14,rows:25},Faexze:{start:2260,cols:23,rows:16},Famiay:{start:34617,cols:15,rows:13},Famida:{start:326837,cols:25,rows:19},Famiso:{start:42924,cols:22,rows:15},Faphida:{start:19144,cols:22,rows:14},Fawaol:{start:302752,cols:20,rows:25},Fomalhaut:{start:27014,cols:20,rows:20},Fornacis:{start:145142,cols:25,rows:30},"FR 3-328":{start:320990,cols:12,rows:20},Furud:{start:120665,cols:15,rows:20},"Gienah Cygni":{start:120965,cols:15,rows:26},Gilo:{start:81805,cols:18,rows:21},"GM 4-572":{start:54372,cols:15,rows:13},Gomeisa:{start:145892,cols:30,rows:23},Greandin:{start:27414,cols:14,rows:23},Grecein:{start:8557,cols:13,rows:16},Greenso:{start:377820,cols:20,rows:16},Grefaho:{start:19452,cols:21,rows:20},Greliai:{start:303252,cols:16,rows:20},Gresoin:{start:327312,cols:25,rows:21},Gretiay:{start:104871,cols:20,rows:20},"GT 3-328":{start:327837,cols:14,rows:16},"GV 4-652":{start:34812,cols:12,rows:12},"HC 4-962":{start:34956,cols:12,rows:13},Heze:{start:146605,cols:35,rows:40},"HO 2-296":{start:48098,cols:15,rows:11},Hoanda:{start:2628,cols:16,rows:18},Hobeex:{start:308129,cols:19,rows:14},Hocancan:{start:43254,cols:17,rows:19},Homam:{start:121355,cols:17,rows:22},Hooth:{start:82183,cols:25,rows:13},Hource:{start:303572,cols:19,rows:16},"HW 3-863":{start:96444,cols:16,rows:20},Iceo:{start:8765,cols:20,rows:14},Inena:{start:35112,cols:14,rows:21},Inioen:{start:308395,cols:13,rows:14},Iniolol:{start:27736,cols:17,rows:14},Inliaa:{start:9045,cols:12,rows:10},Iohofa:{start:328061,cols:24,rows:16},Ioliaa:{start:105271,cols:18,rows:16},Ioquex:{start:82508,cols:16,rows:15},Iowagre:{start:303876,cols:18,rows:12},Iozeio:{start:48263,cols:19,rows:13},"IP 3-251":{start:7395,cols:16,rows:9},Izar:{start:121729,cols:16,rows:18},"JG 2-013":{start:308577,cols:20,rows:8},"JO 4-132":{start:378140,cols:20,rows:20},"JS 2-090":{start:35406,cols:13,rows:10},Keid:{start:122017,cols:20,rows:20},Keldon:{start:27974,cols:26,rows:34},Kenlada:{start:7773,cols:25,rows:20},Kitalpha:{start:96764,cols:17,rows:16},"KU 3-616":{start:28858,cols:12,rows:8},Laanex:{start:28954,cols:15,rows:16},Labela:{start:148005,cols:34,rows:38},Ladaen:{start:321230,cols:20,rows:23},Laedgre:{start:43577,cols:19,rows:20},Lagreen:{start:328445,cols:16,rows:20},Lahola:{start:54567,cols:25,rows:21},Lalande:{start:2916,cols:7,rows:10},Lamice:{start:9165,cols:25,rows:22},Laolla:{start:20240,cols:12,rows:17},Lasolia:{start:82748,cols:19,rows:16},Lave:{start:2986,cols:23,rows:16},Lavebe:{start:328765,cols:23,rows:8},Lazebe:{start:122417,cols:28,rows:19},Leesti:{start:308737,cols:15,rows:16},Let:{start:328949,cols:22,rows:34},Liaackti:{start:321690,cols:20,rows:23},Liaface:{start:308977,cols:20,rows:20},Lianla:{start:9715,cols:20,rows:20},Liaququ:{start:105559,cols:17,rows:24},"LN 3-141":{start:29194,cols:6,rows:6},"LO 2-014":{start:35536,cols:10,rows:3},Maia:{start:35566,cols:20,rows:13},Matar:{start:122949,cols:16,rows:16},Mebsuta:{start:97036,cols:17,rows:20},Menkar:{start:149297,cols:27,rows:34},Menkent:{start:105967,cols:20,rows:17},Meram:{start:168151,cols:20,rows:25},Miackio:{start:304092,cols:25,rows:16},Miarin:{start:3354,cols:7,rows:20},Miayack:{start:10115,cols:24,rows:14},Miayda:{start:378540,cols:25,rows:17},Micanex:{start:35826,cols:20,rows:20},Mintaka:{start:150215,cols:40,rows:25},Miola:{start:329697,cols:25,rows:19},Miphimi:{start:43957,cols:22,rows:18},Mizar:{start:51715,cols:16,rows:23},Naos:{start:106307,cols:17,rows:18},Nari:{start:137155,cols:34,rows:37},Nashira:{start:123205,cols:24,rows:21},Nebul:{start:36226,cols:12,rows:26},Nekkar:{start:123709,cols:14,rows:24},"Nex 0001":{start:83052,cols:23,rows:25},"Nex 0002":{start:44353,cols:20,rows:25},"Nex 0003":{start:55092,cols:25,rows:20},"Nex 0004":{start:97376,cols:25,rows:25},"Nex 0005":{start:324426,cols:25,rows:25},"Nex 0006":{start:378965,cols:25,rows:25},"Nex Kataam":{start:47473,cols:25,rows:25},Nhandu:{start:160515,cols:28,rows:40},Nionquat:{start:36538,cols:15,rows:20},Nunki:{start:167638,cols:19,rows:27},Nusakan:{start:98001,cols:25,rows:19},Oauress:{start:322150,cols:22,rows:16},Olaeth:{start:124045,cols:18,rows:14},Olaso:{start:330172,cols:25,rows:20},Olbea:{start:10451,cols:21,rows:22},Olcanze:{start:44853,cols:20,rows:20},Oldain:{start:304492,cols:18,rows:18},Olexti:{start:3494,cols:8,rows:16},Ollaffa:{start:309377,cols:17,rows:14},Olphize:{start:20858,cols:19,rows:21},"Omicron Eridani":{start:36838,cols:16,rows:19},Ook:{start:3622,cols:15,rows:15},Ophiuchi:{start:55592,cols:22,rows:20},Orerve:{start:3847,cols:18,rows:15},Oucanfa:{start:379590,cols:15,rows:15},"PA 2-013":{start:330672,cols:20,rows:17},Paan:{start:56032,cols:25,rows:23},Pardus:{start:151215,cols:100,rows:93},"Pass EMP-01":{start:15053,cols:20,rows:25},"Pass EMP-02":{start:15553,cols:18,rows:20},"Pass EMP-03":{start:31688,cols:25,rows:20},"Pass EMP-04":{start:58622,cols:25,rows:25},"Pass EMP-05":{start:59247,cols:13,rows:20},"Pass EMP-06":{start:110762,cols:25,rows:13},"Pass EMP-07":{start:312856,cols:25,rows:23},"Pass EMP-08":{start:313431,cols:25,rows:21},"Pass EMP-09":{start:313956,cols:25,rows:25},"Pass EMP-10":{start:314581,cols:25,rows:25},"Pass EMP-11":{start:315206,cols:15,rows:22},"Pass FED-01":{start:15913,cols:18,rows:17},"Pass FED-02":{start:16219,cols:13,rows:19},"Pass FED-03":{start:39275,cols:17,rows:15},"Pass FED-04":{start:39530,cols:25,rows:22},"Pass FED-05":{start:40080,cols:21,rows:21},"Pass FED-06":{start:40521,cols:18,rows:23},"Pass FED-07":{start:85857,cols:27,rows:15},"Pass FED-08":{start:315536,cols:14,rows:23},"Pass FED-09":{start:315858,cols:23,rows:17},"Pass FED-10":{start:316249,cols:19,rows:20},"Pass FED-11":{start:316629,cols:22,rows:17},"Pass FED-12":{start:317003,cols:21,rows:22},"Pass FED-13":{start:381583,cols:16,rows:21},"Pass UNI-01":{start:111087,cols:25,rows:16},"Pass UNI-02":{start:111487,cols:10,rows:10},"Pass UNI-03":{start:111587,cols:18,rows:20},"Pass UNI-04":{start:127261,cols:25,rows:25},"Pass UNI-05":{start:127886,cols:25,rows:26},"Pass UNI-06":{start:317465,cols:17,rows:19},"Pass UNI-07":{start:317788,cols:23,rows:24},"Pass UNI-08":{start:318340,cols:20,rows:31},"Pass UNI-09":{start:381919,cols:20,rows:15},Phaet:{start:124297,cols:17,rows:16},Phao:{start:98476,cols:21,rows:20},Phekda:{start:37142,cols:8,rows:17},Phiagre:{start:45253,cols:21,rows:13},Phiandgre:{start:322502,cols:24,rows:20},Phicanho:{start:10913,cols:13,rows:25},"PI 4-669":{start:29230,cols:9,rows:10},"PJ 3373":{start:4117,cols:10,rows:6},"PO 4-991":{start:11238,cols:20,rows:14},Polaris:{start:83627,cols:10,rows:14},Pollux:{start:29320,cols:20,rows:10},"PP 5-713":{start:325051,cols:15,rows:13},Procyon:{start:161635,cols:37,rows:31},Propus:{start:379815,cols:16,rows:20},Quaack:{start:162782,cols:28,rows:25},Quana:{start:11518,cols:16,rows:26},Quaphi:{start:304816,cols:17,rows:14},Quator:{start:29520,cols:18,rows:18},Quexce:{start:106613,cols:19,rows:24},Quexho:{start:322982,cols:17,rows:14},Quince:{start:56607,cols:14,rows:16},Qumia:{start:83767,cols:20,rows:15},Qumiin:{start:309615,cols:18,rows:20},Quurze:{start:4177,cols:16,rows:20},"QW 2-014":{start:21257,cols:15,rows:9},"RA 3-124":{start:309975,cols:12,rows:12},"Ras Elased":{start:163482,cols:41,rows:40},Rashkan:{start:37278,cols:25,rows:29},Regulus:{start:29844,cols:16,rows:16},Remo:{start:45526,cols:28,rows:26},Retho:{start:21392,cols:22,rows:22},Rigel:{start:165122,cols:49,rows:34},Ross:{start:46254,cols:17,rows:15},Rotanev:{start:98896,cols:16,rows:19},"RV 2-578":{start:11934,cols:14,rows:12},"RX 3-129":{start:305054,cols:13,rows:12},"SA 2779":{start:4497,cols:16,rows:5},Sargas:{start:166788,cols:34,rows:25},"SD 3-562":{start:46509,cols:23,rows:19},Seginus:{start:99200,cols:17,rows:18},"SF 5-674":{start:310119,cols:13,rows:22},Siberion:{start:4577,cols:25,rows:15},"Sigma Draconis":{start:12102,cols:25,rows:20},Silaad:{start:380135,cols:25,rows:20},Sirius:{start:124569,cols:30,rows:25},Ska:{start:12602,cols:40,rows:25},Sobein:{start:331012,cols:15,rows:12},Sodaack:{start:56831,cols:15,rows:16},Soessze:{start:21876,cols:20,rows:20},Sohoa:{start:38003,cols:14,rows:16},Sol:{start:4952,cols:24,rows:29},Solaqu:{start:84067,cols:25,rows:25},Soolti:{start:310405,cols:21,rows:20},Sophilia:{start:107069,cols:24,rows:17},Sowace:{start:325246,cols:19,rows:21},Spica:{start:107477,cols:20,rows:23},Stein:{start:323220,cols:16,rows:16},Subra:{start:125319,cols:20,rows:20},"SZ 4-419":{start:30100,cols:12,rows:7},"Tau Ceti":{start:5648,cols:25,rows:15},"TG 2-143":{start:22276,cols:11,rows:12},Thabit:{start:99506,cols:25,rows:25},Tiacan:{start:38227,cols:15,rows:18},Tiacken:{start:22408,cols:19,rows:28},Tiafa:{start:310825,cols:24,rows:27},Tianbe:{start:30184,cols:19,rows:15},Tiexen:{start:13602,cols:19,rows:20},Tigrecan:{start:331192,cols:19,rows:13},Tiliala:{start:57071,cols:25,rows:17},Tiurio:{start:305210,cols:25,rows:14},Tivea:{start:323476,cols:25,rows:20},Turais:{start:125719,cols:20,rows:23},"UF 3-555":{start:311473,cols:14,rows:14},"UG 5-093":{start:126179,cols:22,rows:23},Urandack:{start:13982,cols:20,rows:15},Ureneth:{start:311669,cols:18,rows:17},Uressce:{start:331439,cols:20,rows:17},Urfaa:{start:107937,cols:23,rows:20},Urhoho:{start:22940,cols:18,rows:18},Urioed:{start:57496,cols:21,rows:9},Urlafa:{start:30469,cols:17,rows:16},Ururur:{start:46946,cols:20,rows:17},Usube:{start:23264,cols:14,rows:30},"Uv Seti":{start:331779,cols:22,rows:15},"UZ 8-466":{start:84692,cols:20,rows:13},Veareth:{start:57685,cols:19,rows:25},Vecelia:{start:380635,cols:15,rows:26},Veedfa:{start:323976,cols:14,rows:15},Vega:{start:108857,cols:30,rows:25},Veliace:{start:332109,cols:25,rows:16},Vewaa:{start:30741,cols:22,rows:15},"VH 3-344":{start:14282,cols:8,rows:16},"VM 3-326":{start:311975,cols:25,rows:10},Waarze:{start:58160,cols:20,rows:14},Waayan:{start:38497,cols:25,rows:16},Wainze:{start:109607,cols:17,rows:16},Waiophi:{start:14410,cols:17,rows:15},Wamien:{start:312225,cols:25,rows:15},Waolex:{start:84952,cols:25,rows:25},Wasat:{start:100131,cols:25,rows:19},Watibe:{start:305560,cols:21,rows:15},Wezen:{start:126685,cols:20,rows:20},"WG 3-288":{start:31071,cols:9,rows:13},"WI 4-329":{start:332509,cols:16,rows:21},"WO 3-290":{start:47286,cols:17,rows:11},Wolf:{start:31188,cols:18,rows:20},"WP 3155":{start:6023,cols:17,rows:7},"WW 2-934":{start:127085,cols:16,rows:11},"XC 3-261":{start:14665,cols:16,rows:13},Xeho:{start:381025,cols:16,rows:17},Xewao:{start:312600,cols:16,rows:16},"XH 3819":{start:6142,cols:16,rows:12},"YC 3-268":{start:38897,cols:14,rows:15},Yildun:{start:100606,cols:14,rows:17},"YS 3-386":{start:305875,cols:14,rows:20},"YV 3-386":{start:109879,cols:12,rows:18},Zamith:{start:23684,cols:18,rows:18},Zaniah:{start:100844,cols:16,rows:16},Zaurak:{start:110095,cols:17,rows:27},Zeaay:{start:332845,cols:27,rows:14},Zeaex:{start:39107,cols:12,rows:14},Zearla:{start:306155,cols:17,rows:16},Zelada:{start:85577,cols:14,rows:20},Zeolen:{start:14873,cols:15,rows:12},Zezela:{start:31548,cols:14,rows:10},Zirr:{start:24008,cols:25,rows:18},"ZP 2-989":{start:58440,cols:13,rows:14},"ZS 3-798":{start:306427,cols:13,rows:20},"ZU 3-239":{start:381297,cols:13,rows:22},"Zuben Elakrab":{start:101100,cols:25,rows:17},"ZZ 2986":{start:6334,cols:15,rows:5}},a=new Map;for(const t of Object.keys(r))a.set(t,new o(t,r[t].start,r[t].cols,r[t].rows));a.getSectorForTile=function(t){for(const e of this.getSectors())if(e.contains(t))return e;throw new Error(`No sector found for tile id ${t}`)},a.getSectorAndCoordsForTile=function(t){return this.getSectorForTile(t).getTileHumanString(t)},a.getTileIdFromSectorAndCoords=function(t,e,s){if(t.endsWith("NE")&&(t=t.substring(0,t.length-3)),(t.endsWith("East")||t.endsWith("West"))&&(t=t.substring(0,t.length-5)),(t.endsWith("North")||t.endsWith("South")||t.endsWith("Inner"))&&(t=t.substring(0,t.length-6)),!this.has(t))throw`No data for sector '${t}'!`;return this.get(t).getTileByCoords(e,s)},a.getSectors=function*(){for(const t of this)yield t[1]};class n{#p=!1;#f;#m;#b;#w=[];#v;#y=[];#x=[];constructor(t={squad:!1}){this.#p=t.squad,this.refresh()}addAfterRefreshHook(t){this.#y.push(t)}addBeforeRefreshHook(t){this.#x.push(t)}#E(){for(const t of this.#x)t()}#F(t={}){for(const e of this.#y)e(t)}get height(){return this.#m}get width(){return this.#b}get grid(){return this.#w}get centreTile(){return this.#v}addTilesHighlights(t){for(const e of this.clickableTiles())t.has(e.id)&&e.addHighlights(t.get(e.id))}addTilesHighlight(t){for(const e of this.clickableTiles())t.has(e.id)&&e.addHighlight(t.get(e.id))}clearTilesHighlights(){for(const t of this.clickableTiles())t.clearHighlight()}refreshTilesToHighlight(t){this.tiles_to_highlight=t,this.reload(!0)}refresh(){this.#E(),this.#_(),this.#F()}#_(){this.#f=document.getElementById("navareatransition"),this.#f&&"none"!==this.#f.style.display||(this.#f=document.getElementById("navarea")),this.#m=this.#f.rows.length,this.#b=this.#f.rows[0].childElementCount,this.#w=[],this.tiles_map=new Map;let t=0,e=0;for(const s of this.#f.rows){const o=[];for(const r of s.children){let s;s=this.#p?e*this.#b+t:parseInt(r.id.match(/[^\d]*(\d*)/)[1]);const a=s%this.#b,n=Math.floor(s/this.#b),l=new i(r,a,n);o.push(l),this.tiles_map.set(l.id,l),t++}this.#w.push(o),e++,t=0}const s=Math.floor(this.#b/2),o=Math.floor(this.#m/2);if(this.#v=this.#w[o][s],this.#v.is_centre_tile=!0,(!this.#v.id||"-1"===this.#v.id)&&"-1"!==this.#w[o-1][s].id){const t=parseInt(this.#w[o-1][s].id)+1;this.#v.id=t}}getTileOrVirtual(t,e,s){return t>=this.#w[0].length||t<0||e<0||e>=this.#w.length?a.getSectorForTile(s.id).getVirtualTile(t,e,s):this.#w[e][t]}*yieldPathBetween(t,e,s=!1){let i=t;for(yield i;i.x!=e.x||i.y!=e.y;){let t=0,s=0;if(i.x>e.x?t=-1:i.x<e.x&&(t=1),i.y>e.y?s=-1:i.y<e.y&&(s=1),0==t&&0==s)break;let o=this.#w[i.y+s][i.x+t];if(!o.isNavigatable()){if(o.isVirtualTile())break;if(0!=t&&0!=s){if(o=this.getTileOrVirtual(i.x,i.y+s,i),!o.isNavigatable()&&(o=this.getTileOrVirtual(i.x+t,i.y,i),!o.isNavigatable()))break}else if(0==t){if(o=this.getTileOrVirtual(i.x+1,i.y+s,i),!(o.isNavigatable()||o.isVirtualTile()||(o=this.getTileOrVirtual(i.x-1,i.y+s,i),o.isNavigatable()||o.isVirtualTile())))break}else if(0==s&&(o=this.getTileOrVirtual(i.x+t,i.y+1,i),!(o.isNavigatable()||o.isVirtualTile()||(o=this.getTileOrVirtual(i.x+t,i.y-1,i),o.isNavigatable()||o.isVirtualTile()))))break}i=o,yield i}}getPathBetween(t,e){return Array.from(this.yieldPathBetween(t,e))}getPathTo(t){return this.getPathBetween(this.#v,t)}getPathFrom(t){return this.getPathBetween(t,this.#v)}*yieldPathTo(t){yield*this.yieldPathBetween(this.#v,t)}*yieldPathFrom(t,e=!1){const s=this.getTile(t);yield*this.yieldPathBetween(s,this.#v,e)}getTile(t){return this.tiles_map.has(t)?this.tiles_map.get(t):null}*tiles(){for(const t of this.#w)for(const e of t)yield e}*clickableTiles(){for(const t of this.tiles())t.isClickable()&&(yield t)}*navigatableTiles(){for(const t of this.tiles())t.isNavigatable()&&(yield t)}getTileOnNav(t){for(const e of this.tiles())if(e.id===t)return e;return null}nav(t){if("function"==typeof navAjax)return navAjax(t);if("function"==typeof nav)return nav(t);throw new Error("No function for nav or navAjax found!")}warp(t){if("function"==typeof warpAjax)return warpAjax(t);if("function"==typeof warp)return warp(t);throw new Error("No function for warp or warpAjax found!")}xhole(t){if(!["44580","47811","55343","83339","97698","324730","379305"].includes(t))throw new Error(`Destination ${t} is not a valid X-hole!`);return document.getElementById("xholebox").elements.warpx.value=t,"function"==typeof warpX?warpX():document.getElementById("xholebox").submit()}}class l extends s{#$;constructor(){super("/main.php"),this.#$=new n,this.#B(()=>{this.#$.refresh()})}get nav(){return this.#$}#B(t){const e=document.getElementById("tdSpaceChart")?document.getElementById("tdSpaceChart").getElementsByTagName("table")[0].rows[1]:document.querySelectorAll('table td[valign="top"]')[1];new MutationObserver(function(e,s){t()}).observe(e,{attributes:!1,childList:!0,subtree:!0})}}class d extends s{constructor(){super("/logout.php")}}class h{#C;constructor(){switch(document.location.pathname){case"/main.php":this.#C=new l;break;case"/logout.php":this.#C=new d;break;default:this.#C="No page implemented!"}}get page(){return document.location.pathname}get currentPage(){return this.#C}get main(){return"/main.php"===this.page?this.#C:null}static getImagePackUrl(){const t=String(document.querySelector("body").style.backgroundImage).replace(/url\("*|"*\)|[a-z0-9]+\.gif/g,"");return""!==t?t:"//static.pardus.at/img/std/"}static getUniverse(){switch(document.location.hostname){case"orion.pardus.at":return"orion";case"artemis.pardus.at":return"artemis";case"pegasus.pardus.at":return"pegasus";default:throw new Error("Unable to determine universe")}}}class c{static defaultSaveFunction(t,e){return GM_setValue(t,e)}static defaultGetFunction(t,e=null){return GM_getValue(t,e)}static defaultDeleteFunction(t){return GM_deleteValue(t)}static getUniverse(){switch(document.location.hostname){case"orion.pardus.at":return"orion";case"artemis.pardus.at":return"artemis";case"pegasus.pardus.at":return"pegasus";default:throw new Error("Unable to determine universe")}}static getVariableName(t){return`${this.getUniverse()}_${t}`}static getVariableValue(t,e=null){return this.defaultGetFunction(this.getVariableName(t),e)}static setVariableValue(t,e){return this.defaultSaveFunction(this.getVariableName(t),e)}static deleteVariableValue(t){return this.defaultDeleteFunction(this.getVariableName(t))}static setActiveTab(t){window.localStorage.setItem("pardusOptionsOpenTab",t),window.dispatchEvent(new window.Event("storage"))}static getImagePackUrl(){const t=String(document.querySelector("body").style.backgroundImage).replace(/url\("*|"*\)|[a-z0-9]+\.gif/g,"");return""!==t?t:"//static.pardus.at/img/std/"}static addGlobalListeners(){EventTarget.prototype.addPardusKeyDownListener=function(t,e=null,s,i=!1){const o=c.getVariableValue(t,e);if(!o)throw new Error(`No Pardus variable ${t} defined!`);if(Object.hasOwn(o,"disabled"))return;if(this.pardusListeners||(this.pardusListeners=[]),this.pardusListeners.includes(`${o.code}${t}`))return;this.pardusListeners.push(`${o.code}${t}`);this.addEventListener("keydown",t=>{t.isComposing||229===t.keyCode||t.repeat||t.keyCode===o.code&&s(t)},i)}}}class u{constructor(t){if(!t||""===t)throw new Error("Id cannot be empty.");if(!/^[a-zA-Z][\w:.-]*$/.test(t))throw new Error(`Id '${t}' is not a valid HTML identifier.`);this.id=t,this.afterRefreshHooks=[],this.beforeRefreshHooks=[]}addEventListener(t,e,s=!1){this.getElement()&&this.getElement().addEventListener(t,e,s),s&&Object.hasOwn(s,"ephemeral")&&s.ephemeral||this.addAfterRefreshHook(()=>{this.getElement()&&this.getElement().addEventListener(t,e,s)})}removeEventListener(t,e){this.getElement()&&this.getElement().removeEventListener(t,e)}toString(){return`<div id='${this.id}'></div>`}beforeRefreshElement(){for(const t of this.beforeRefreshHooks)t()}afterRefreshElement(t={}){for(const e of this.afterRefreshHooks)e(t)}addAfterRefreshHook(t){this.afterRefreshHooks.push(t)}refreshElement(){this.beforeRefreshElement(),this.getElement().replaceWith(this.toElement()),this.afterRefreshElement()}getOffsetTop(){let t=this.getElement().offsetTop+this.getElement().offsetHeight,e=this.getElement().offsetParent;for(;null!==e;)t+=e.offsetTop,e=e.offsetParent;return t}getOffsetLeft(){let t=this.getElement().offsetLeft,e=this.getElement().offsetParent;for(;null!==e;)t+=e.offsetLeft,e=e.offsetParent;return t}getElement(){return document.getElementById(this.id)}toElement(){const t=document.createElement("template");return t.innerHTML=this.toString(),t.content.firstChild}appendChild(t){return document.getElementById(this.id).appendChild(t)}appendTableChild(t){return document.getElementById(this.id).firstChild.appendChild(t)}setHTML(t){this.innerHtml=t}}class g extends u{constructor({id:t}){super(t),this.contents="",this.title="",this.addEventListener("click",()=>{this.hide()})}setContents({contents:t="",title:e=""}){this.contents=t,this.title=e,this.refreshElement()}setPosition({element:t,position:e="right"}){let s=15,i=-13;switch(e){case"left":s+=-220;break;case"er":s+=128;break;case"lf":s+=-160,i+=-310}this.getElement().style.top=`${t.getOffsetTop()+i}px`,this.getElement().style.left=`${t.getOffsetLeft()+s}px`}show(){this.getElement().removeAttribute("hidden")}hide(){this.getElement().setAttribute("hidden","")}toString(){return`<div id="${this.id}" hidden="" style="position: absolute; width: 200px; z-index: 100; border: 1pt black solid; background: #000000; padding: 0px;"><table class="messagestyle" style="background:url(${c.getImagePackUrl()}bgd.gif)" width="100%" cellspacing="0" cellpadding="3"><tbody><tr><td style="text-align:left;background:#000000;"><b>${this.title}</b></td></tr><tr><td style="text-align:left;">${this.contents}</td></tr><tr><td height="5"><spacer type="block" width="1" height="1"></spacer></td></tr><tr><td style="text-align:right;background:#31313A;"><b>GNN Library</b><img src="${c.getImagePackUrl()}info.gif" width="10" height="12" border="0"></td></tr></tbody></table></div>`}}class p extends u{constructor({id:t,hidden:e=!1}){super(t),this.hidden=e,this.labels=[],this.addAfterRefreshHook(()=>{for(const t of this.labels)t.afterRefreshElement()})}addLabel({label:t}){this.labels.push(t),this.getElement()&&(this.appendChild(t.toElement()),t.afterRefreshElement())}show(){this.hidden=!1,this.refreshElement()}hide(){this.hidden=!0,this.refreshElement()}toString(){return this.hidden?`<tr id="${this.id}" cellspacing="0" cellpadding="0" border="0" hidden="">${this.labels.join("")}</tr>`:`<tr id="${this.id}" cellspacing="0" cellpadding="0" border="0">${this.labels.join("")}</tr>`}}class f extends u{constructor({id:t}){super(t),this.tabsRow=new p({id:`${this.id}-row`})}addLabel({label:t}){this.tabsRow.addLabel({label:t})}toString(){return`<table id="${this.id}" cellspacing="0" cellpadding="0" border="0" align="left"><tbody>${this.tabsRow}</tbody></table>`}}class m extends u{constructor({id:t}){super(t)}addContent({content:t}){this.appendChild(document.createElement("div").appendChild(t.toElement())),t.afterRefreshElement({maintainRefreshStatus:!0})}toString(){return`<tr id="${this.id}" cellspacing="0" cellpadding="0" border="0"></tr>`}}class b extends u{constructor({id:t,heading:e,active:s=!1,padding:i="0px"}){super(t),this.padding=i,this.heading=e,this.active=s,this.addEventListener("mouseover",()=>{this.active||(this.getElement().style.backgroundImage=`url(${c.getImagePackUrl()}tabactive.png)`),this.getElement().style.cursor="default"}),this.addEventListener("mouseout",()=>{this.active||(this.getElement().style.backgroundImage=`url(${c.getImagePackUrl()}tab.png)`,this.getElement().style.cursor="default")})}toString(){const t=this.active?"tabactive":"tab";return`<td id="${this.id}" style="background: transparent url(&quot;${c.getImagePackUrl()}${t}.png&quot;) no-repeat scroll 0% 0%; background-size: cover; cursor: default; padding-left: ${this.padding}; padding-right: ${this.padding}" class="tabcontent">${this.heading}</td>`}setActive(){this.getElement().style.backgroundImage=`url('${c.getImagePackUrl()}tabactive.png')`,this.active=!0}setInactive(){this.getElement().style.backgroundImage=`url('${c.getImagePackUrl()}tab.png')`,this.active=!1}}class w extends u{constructor({id:t,disabled:e=!1}){super(t),this.disabled=e}disable(){this.setDisabled(!0),this.refreshElement()}enable(){this.setDisabled(!1),this.refreshElement()}setDisabled(t=!1){this.disabled=t}}class v extends w{constructor({id:t,premium:e=!1,disabled:s=!1,styleExtra:i="",actionText:o="",actionPerformedText:r=""}){super({id:t,disabled:s}),this.premium=e,this.premium?this.colour="#FFCC11":this.colour="#D0D1D9",this.backgroundColour="#00001C",this.disabled&&(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC"),this.styleExtra=i,this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`,this.actionText=o,this.actionPerformedText=r}toString(){return`<input value="${this.actionText}" id="${this.id}" type="button" style="${this.style}" ${this.disabled?"disabled":""}>`}addClickListener(t,e=!1){this.getElement()&&this.getElement().addEventListener("click",t,e),e&&Object.hasOwn(e,"ephemeral")&&e.ephemeral||this.addAfterRefreshHook(()=>{this.getElement()&&this.getElement().addEventListener("click",t,e)})}setActionText(t="",e=""){this.actionText=t,this.actionPerformedText=e,this.refreshElement()}displayClicked(){this.getElement().setAttribute("disabled","true"),this.getElement().value=this.actionPerformedText,this.getElement().setAttribute("style","color:green;background-color:silver"),setTimeout(()=>{this.getElement().removeAttribute("disabled"),this.getElement().value=this.actionText,this.premium?this.getElement().setAttribute("style","color:#FFCC11"):this.getElement().removeAttribute("style")},2e3)}setDisabled(t=!1){this.disabled=t,this.disabled?(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC"):(this.premium?this.colour="#FFCC11":this.colour="#D0D1D9",this.backgroundColour="#00001C"),this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`}disable(){this.setDisabled(!0),this.getElement()&&(this.getElement().setAttribute("disabled","true"),this.getElement().setAttribute("style",this.style))}enable(){this.setDisabled(!1),this.getElement()&&(this.getElement().removeAttribute("disabled"),this.getElement().setAttribute("style",this.style))}}class y extends v{constructor({id:t,premium:e=!1,disabled:s=!1}){super({id:t,premium:e,disabled:s,actionText:"Save",actionPerformedText:"Saved"})}displaySaved(){this.displayClicked()}}class x extends v{constructor({id:t,premium:e=!1,disabled:s=!1}){super({id:t,premium:e,disabled:s,actionText:"Reset",actionPerformedText:"Reset"})}displayReset(){this.displayClicked()}}class E extends w{constructor({id:t,premium:e=!1,resetButton:s=!1,disabled:i=!1}){super({id:t,disabled:i}),this.premium=e,this.saveButton=new y({id:`${this.id}-button`,premium:e,disabled:i}),this.resetButton=s?new x({id:`${this.id}-reset-button`,premium:e,disabled:i}):null}toString(){return`<tr id="${this.id}"><td align="right" style="padding-right: 6px;">${this.resetButton?`${this.resetButton}&nbsp`:""}${this.saveButton}</td></tr>`}setDisabled(t=!1){this.disabled=t,this.saveButton.setDisabled(t),this.resetButton&&this.resetButton.setDisabled(t)}displaySaved(){this.saveButton.displaySaved()}displayReset(){this.resetButton&&this.resetButton.displayReset()}addSaveEventListener(t){this.saveButton.addEventListener("click",t)}addResetEventListener(t){this.resetButton&&this.resetButton.addEventListener("click",t)}}class F extends v{constructor({id:t,premium:e=!1,disabled:s=!1}){super({id:t,premium:e,disabled:s,actionText:"Load",actionPerformedText:"Loaded"})}displayLoaded(){this.displayClicked()}}class _ extends w{constructor({id:t,disabled:e=!1,defaultValue:s=""}){super({id:t,disabled:e}),this.defaultValue=s,this.styleExtra="",this.colour="#D0D1D9",this.backgroundColour="#00001C",this.disabled&&(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC"),this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`}toString(){return`<input id="${this.id}" type="text" value="${this.getValue()}" style="${this.style}" ${this.disabled?"disabled":""}></input>`}save(){c.defaultSaveFunction(`${c.getVariableName(this.id)}`,this.getCurrentValue())}hasValue(){return!!c.defaultGetFunction(`${c.getVariableName(this.id)}`,!1)}disable(){this.setDisabled(!0),this.getInputElement()&&(this.getInputElement().removeAttribute("disabled"),this.getInputElement().setAttribute("style",this.style))}enable(){this.setDisabled(!1),this.getInputElement()&&(this.getInputElement().removeAttribute("disabled"),this.getInputElement().setAttribute("style",this.style))}setDisabled(t=!1){this.disabled=t,this.disabled?(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC"):(this.colour="#D0D1D9",this.backgroundColour="#00001C"),this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`}getInputElement(){return document.getElementById(this.id)}getCurrentValue(){return this.getInputElement().value}getValue(){return c.defaultGetFunction(`${c.getVariableName(this.id)}`,this.defaultValue)}}class $ extends w{constructor({id:t,premium:e=!1,disabled:s=!1,presetNumber:i}){super({id:t,disabled:s}),this.premium=e,this.saveButton=new y({id:`${this.id}-save-button`,premium:e,disabled:s}),this.loadButton=new F({id:`${this.id}-load-button`,premium:e,disabled:s}),this.presetNumber=i,this.label=new _({id:`${this.id}-label`,defaultValue:`Preset ${this.presetNumber}`,disabled:s}),this.hasValue()||this.loadButton.disable()}toString(){return`<tr id="${this.id}"><td align="left">${this.label}</input></td><td align="right">${this.loadButton} ${this.saveButton}</td></tr>`}setDisabled(t=!1){this.disabled=t,this.saveButton.setDisabled(t),this.loadButton.setDisabled(t),this.label.setDisabled(t)}displaySaved(){this.saveButton.displaySaved()}displayLoaded(){this.loadButton&&this.loadButton.displayLoaded()}hasValue(){return this.label.hasValue()}setFunctions(t){0!==t.length&&(this.addSaveEventListener(()=>{for(const e of t)e.saveValue((t,s)=>{e.saveFunction(`preset-${this.presetNumber}-${t}`,s)});this.displaySaved(),this.loadButton.enable(),this.label.save();const e=new Event("preset-save",{bubbles:!0});this.getElement().dispatchEvent(e)}),this.addLoadEventListener(()=>{for(const e of t)e.loadValue(e.getValue((t,s)=>e.getFunction(`preset-${this.presetNumber}-${t}`,s)));this.displayLoaded();const e=new Event("preset-load",{bubbles:!0});this.getElement().dispatchEvent(e)}))}addSaveEventListener(t){this.saveButton.addEventListener("click",t)}addLoadEventListener(t){this.loadButton&&this.loadButton.addEventListener("click",t)}}class B extends w{constructor({id:t,premium:e=!1,disabled:s=!1,presets:i=0}){super({id:t,disabled:s}),this.premium=e,this.presets=[];for(let t=0;t<i;t+=1)this.presets.push(new $({id:`${this.id}-preset-row-${t}`,premium:e,disabled:s,presetNumber:t+1}))}setDisabled(t=!1){this.disabled=t;for(const e of this.presets)e.setDisabled(t)}toString(){if(0===this.presets.length)return"";let t=`<tr id="${this.id}"><td><table width="100%">`;for(const e of this.presets)t+=e;return`${t}</table></td></tr>`}setFunctions(t){for(const e of this.presets)e.setFunctions(t)}}class C extends u{constructor({id:t,description:e,title:s,tipBoxPosition:i="right"}){super(t),this.description=e,this.title=s,this.tipBoxPosition=i,this.addEventListener("mouseover",()=>{this.tipBox=j.getDefaultTipBox(),this.tipBox.setContents({title:this.title,contents:this.description}),this.tipBox.setPosition({element:this,position:this.tipBoxPosition}),this.tipBox.show()}),this.addEventListener("mouseout",()=>{this.tipBox.hide()})}toString(){return`<a id="${this.id}" href="#" onclick="return false;"><img src="${c.getImagePackUrl()}info.gif" class="infoButton" alt=""></a>`}}class k extends w{constructor({id:t,variable:e,description:s="",defaultValue:i=!1,saveFunction:o=c.defaultSaveFunction,getFunction:r=c.defaultGetFunction,shallow:a=!1,reverse:n=!1,info:l=null,disabled:d=!1,styleExtra:h="",align:u="left"}){super({id:t,disabled:d}),this.variable=e,this.saveFunction=o,this.getFunction=r,this.description=s,this.info=l,this.defaultValue=i,this.inputId=`${this.id}-input`,this.shallow=a,this.reverse=n,this.styleExtra=h,this.colour="#D0D1D9",this.backgroundColour="#00001C",this.align=u,this.disabled&&(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC"),this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`,null!==this.info?(this.infoElement=new C({id:`${this.id}-info`,description:this.info.description,title:this.info.title}),this.addAfterRefreshHook(()=>{this.infoElement.afterRefreshElement()})):this.infoElement=""}toString(){return this.shallow?`<td id='${this.id}'>${this.getInnerHTML()}<label>${this.description}</label>${this.infoElement}</td>`:this.reverse?`<tr id='${this.id}'><td>${this.getInnerHTML()}</td><td><label for='${this.inputId}'>${this.description}</label>${this.infoElement}</td></tr>`:""===this.description?`<tr id='${this.id}'><td col='2'>${this.getInnerHTML()}</td></tr>`:`<tr id='${this.id}'><td><label for='${this.inputId}'>${this.description}:</label>${this.infoElement}</td><td align='${this.align}'>${this.getInnerHTML()}</td></tr>`}getInnerHTML(){return""}getValue(t=null){return t&&"function"==typeof t?t(`${c.getVariableName(this.variable)}`,this.defaultValue):this.getFunction(`${c.getVariableName(this.variable)}`,this.defaultValue)}getCurrentValue(){return null}getInputElement(){return document.getElementById(this.inputId)}resetValue(){this.saveFunction(`${c.getVariableName(this.variable)}`,this.defaultValue)}saveValue(t=null){t&&"function"==typeof t?t(`${c.getVariableName(this.variable)}`,this.getCurrentValue()):this.disabled||this.saveFunction(`${c.getVariableName(this.variable)}`,this.getCurrentValue())}refreshStyle(){this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`,this.getInputElement()&&this.getInputElement().setAttribute("style",this.style)}disable(){this.setDisabled(!0),this.getInputElement()&&(this.getInputElement().setAttribute("disabled",""),this.getInputElement().setAttribute("style",this.style))}enable(){this.setDisabled(!1),this.getInputElement()&&(this.getInputElement().removeAttribute("disabled"),this.getInputElement().setAttribute("style",this.style))}setDisabled(t=!1){this.disabled=t,this.disabled?(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC"):(this.colour="#D0D1D9",this.backgroundColour="#00001C"),this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`}loadValue(t){this.getInputElement().value=t,this.saveValue()}}class T extends k{getInnerHTML(){let t="";return!0===this.getValue()&&(t=" checked"),`<input id="${this.inputId}" type="checkbox"${t} style="${this.style}" ${this.disabled?"disabled":""}>`}getCurrentValue(){return this.getInputElement().checked}}class V extends k{constructor({id:t,variable:e,description:s,defaultValue:i=0,saveFunction:o=c.defaultSaveFunction,getFunction:r=c.defaultGetFunction,disabled:a=!1,info:n=null,rows:l=3,cols:d=65}){super({id:t,variable:e,description:s,defaultValue:i,saveFunction:o,getFunction:r,info:n,disabled:a,styleExtra:"font-family: Helvetica, Arial, sans-serif;font-size:11px;"}),this.rows=l,this.cols=d}getInnerHTML(){return`<textarea id="${this.inputId}" width="100%" autocomplete="off" autocorrect="off" spellcheck="false" ${0===this.rows?"":`rows="${this.rows}"`} ${0===this.cols?"":`cols="${this.cols}"`} style="${this.style}" ${this.disabled?"disabled":""}>${this.getValue()}</textarea>`}getCurrentValue(){return this.getInputElement().value}}class A extends k{constructor({id:t,variable:e,description:s,defaultValue:i=0,saveFunction:o=c.defaultSaveFunction,getFunction:r=c.defaultGetFunction,disabled:a=!1,min:n=0,max:l=0,step:d=1,info:h=null}){super({id:t,variable:e,description:s,defaultValue:i,saveFunction:o,getFunction:r,info:h,disabled:a}),this.minValue=n,this.maxValue=l,this.stepValue=d}getInnerHTML(){return`<input id="${this.inputId}" type="number" min="${this.minValue}" max="${this.maxValue}" step="${this.stepValue}" value="${this.getValue()}" style="${this.style}" ${this.disabled?"disabled":""}>`}getCurrentValue(){return this.getInputElement().value}}class S extends v{constructor({id:t,premium:e=!1,disabled:s=!1,styleExtra:i="",actionText:o="",actionPerformedText:r="",toggleText:a="",togglePerformedText:n="",toggled:l=!1}){super({id:t,premium:e,disabled:s,styleExtra:i,actionText:o,actionPerformedText:r}),this.toggled=l,this.defaultText=o,this.defaultPerformedText=r,this.toggleText=a,this.togglePerformedText=n,this.toggled&&(this.actionText=this.toggleText,this.actionPerformedText=this.togglePerformedText)}toggle(){this.toggled=!this.toggled,this.toggled?(this.actionText=this.toggleText,this.actionPerformedText=this.togglePerformedText):(this.actionText=this.defaultText,this.actionPerformedText=this.defaultPerformedText),this.refreshElement()}toString(){return`<input value="${this.actionText}" id="${this.id}" type="button" style="${this.style}" ${this.disabled?"disabled":""}>`}displayClicked(){this.getElement().setAttribute("disabled","true"),this.getElement().value=this.actionPerformedText,this.getElement().setAttribute("style","color:green;background-color:silver"),setTimeout(()=>{this.getElement().removeAttribute("disabled"),this.getElement().value=this.actionText,this.premium?this.getElement().setAttribute("style","color:#FFCC11"):this.getElement().removeAttribute("style")},2e3)}addClickListener(t,e=!1){this.getElement()&&!this.toggled&&this.getElement().addEventListener("click",t,e),e&&Object.hasOwn(e,"ephemeral")&&e.ephemeral||this.addAfterRefreshHook(()=>{this.getElement()&&!this.toggled&&this.getElement().addEventListener("click",t,e)})}addToggleClickListener(t,e=!1){this.getElement()&&this.toggled&&this.getElement().addEventListener("click",t,e),e&&Object.hasOwn(e,"ephemeral")&&e.ephemeral||this.addAfterRefreshHook(()=>{this.getElement()&&this.toggled&&this.getElement().addEventListener("click",t,e)})}setDisabled(t=!1){this.disabled=t,this.disabled?(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC"):(this.premium?this.colour="#FFCC11":this.colour="#D0D1D9",this.backgroundColour="#00001C"),this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`}disable(){this.setDisabled(!0),this.getElement()&&(this.getElement().setAttribute("disabled","true"),this.getElement().setAttribute("style",this.style))}enable(){this.setDisabled(!1),this.getElement()&&(this.getElement().removeAttribute("disabled"),this.getElement().setAttribute("style",this.style))}}class P extends S{constructor({id:t,premium:e=!1,disabled:s=!1}){super({id:t,premium:e,disabled:s,actionText:"Set Key",toggleText:"Cancel",styleExtra:"width:58px;"})}}class I extends S{constructor({id:t,premium:e=!1,disabled:s=!1,toggled:i=!1}){super({id:t,premium:e,disabled:s,toggled:i,actionText:"Disable",toggleText:"Enable",styleExtra:"width:58px;"})}}class D extends k{constructor({id:t,variable:e,description:s="",defaultValue:i=!1,saveFunction:o=c.defaultSaveFunction,getFunction:r=c.defaultGetFunction,shallow:a=!1,reverse:n=!1,info:l=null}){const d=r(`${c.getVariableName(e)}`,i),h=Object.hasOwn(d,"disabled")&&d.disabled;super({id:t,variable:e,description:s,defaultValue:i,saveFunction:o,getFunction:r,shallow:a,reverse:n,info:l,disabled:h,styleExtra:"width: 20px;padding: 2px;text-align: center;margin: 2px 7px 2px;"}),this.setKeyButton=new P({id:`${this.id}-setkey`,disabled:h}),this.disableButton=new I({id:`${this.id}-disable`,toggled:h}),this.boundCaptureKeyListener=this.captureKeyListener.bind(this),this.setKeyButton.addClickListener(()=>{document.getElementById(`${this.inputId}-key`).value="_",document.getElementById(`${this.inputId}-key`).style.color="lime",document.addEventListener("keydown",this.boundCaptureKeyListener,{once:!0,ephemeral:!0}),this.setKeyButton.toggle(),this.disableButton.disable()}),this.setKeyButton.addToggleClickListener(()=>{document.removeEventListener("keydown",this.boundCaptureKeyListener),this.setKeyButton.toggle(),this.disableButton.enable(),this.refreshElement()}),this.disableButton.addClickListener(()=>{this.disable(),this.disableButton.toggle()}),this.disableButton.addToggleClickListener(()=>{this.enable(),this.disableButton.toggle()}),this.addAfterRefreshHook(()=>{this.setKeyButton.afterRefreshElement(),this.disableButton.afterRefreshElement()})}captureKeyListener(t){this.getInputElement().value=JSON.stringify({code:t.keyCode,key:t.code,description:t.key}),document.getElementById(`${this.inputId}-key`).value=this.getCurrentKeyDescription(),document.getElementById(`${this.inputId}-key`).style.color="#D0D1D9",this.disableButton.enable(),this.setKeyButton.toggle()}getInnerHTML(){let t=`<input id='${this.inputId}' type='text' hidden value='${JSON.stringify(this.getValue())}'>`;return t+=`<table width='100%' style='border-collapse: collapse;'><tbody><tr><td align="left"><input id='${this.inputId}-key' type='text' cols='1' maxlength='1' readonly value="${this.getKeyDescription()}" style="${this.style}" ${this.disabled?"disabled":""}/></td><td align="right">${this.setKeyButton}</td><td align="right" style='padding-right: 0px;'>${this.disableButton}</td></tr></tbody></table>`,t}disable(){this.setDisabled(!0),document.getElementById(`${this.inputId}-key`).removeAttribute("disabled"),document.getElementById(`${this.inputId}-key`).setAttribute("style",this.style),this.getInputElement().value=JSON.stringify({...this.getCurrentValue(),disabled:!0})}enable(){this.setDisabled(!1),document.getElementById(`${this.inputId}-key`).removeAttribute("disabled"),document.getElementById(`${this.inputId}-key`).setAttribute("style",this.style);const t=this.getCurrentValue();delete t.disabled,this.getInputElement().value=JSON.stringify(t)}setDisabled(t=!1){this.disabled=t,this.disabled?(this.colour="#B5B5B5",this.backgroundColour="#CCCCCC",this.setKeyButton.disable()):(this.colour="#D0D1D9",this.backgroundColour="#00001C",this.setKeyButton.enable()),this.style=`color: ${this.colour};background-color: ${this.backgroundColour};${this.styleExtra}`}saveValue(t=null){t&&"function"==typeof t?t(`${c.getVariableName(this.variable)}`,this.getCurrentValue()):this.saveFunction(`${c.getVariableName(this.variable)}`,this.getCurrentValue())}getKey(){return this.getValue().key}getKeyDescription(){return this.getValue().description}getKeyCode(){return this.getValue().code}isDisabled(){const t=this.getValue();return!(!Object.hasOwn(t,"disabled")||!t.disabled)}getCurrentKey(){return this.getCurrentValue().key}getCurrentKeyDescription(){return this.getCurrentValue().description}getCurrentCode(){return this.getCurrentValue().code}getCurrentValue(){return JSON.parse(this.getInputElement().value)}}class L extends k{constructor({id:t,variable:e,description:s,defaultValue:i=null,saveFunction:o=c.defaultSaveFunction,getFunction:r=c.defaultGetFunction,disabled:a=!1,info:n=null,inheritStyle:l=!1,options:d=[]}){super({id:t,variable:e,description:s,defaultValue:i,saveFunction:o,getFunction:r,info:n,disabled:a,align:"right"}),this.options=d,l&&this.addEventListener("change",()=>{this.updateSelectStyle()})}getInnerHTML(){let t="";const e=this.getValue();let s=!1,i="";for(const o of this.options){const r=o.style?` style="${o.style}"`:"";s||o.value!==e&&(!o.default||!0!==o.default||e)?t+=`<option value=${o.value}${r}>${o.text}</option>`:(t+=`<option value=${o.value}${r} selected>${o.text}</option>`,s=!0,i=o.style?` style="${o.style}"`:"")}return t=`<select id="${this.inputId}"${i} style="${this.style}" ${this.disabled?"disabled":""}>${t}`,t}updateSelectStyle(){const t=this.getInputElement().selectedOptions[0].getAttribute("style");this.getInputElement().setAttribute("style",t)}getOptions(){return this.options}setOptions(t=[]){this.options=t}getCurrentValue(){return this.getInputElement().value}}class R extends u{constructor({id:t,description:e,saveFunction:s=c.defaultSaveFunction,getFunction:i=c.defaultGetFunction}){super(t),this.description=e,this.saveFunction=s,this.getFunction=i,this.options=[]}toString(){return`<tr id="${this.id}"><td>${this.description}</td><td>${this.getInnerHTML()}</td></tr>`}getInnerHTML(){let t="<table><tbody><tr>";for(const e of this.options)t+=e;return t+="</tr></tbody></table>",t}saveValue(){for(const t of this.options)t.saveValue()}addBooleanOption({variable:t,description:e,defaultValue:s=!1,saveFunction:i=this.saveFunction,getFunction:o=this.getFunction}){const r={id:`${this.id}-option-${this.options.length}`,variable:t,description:e,defaultValue:s,saveFunction:i,getFunction:o,shallow:!0},a=new T(r);return this.options.push(a),this.refreshElement(),a}}class H extends w{constructor({id:t,premium:e=!1,saveFunction:s=c.defaultSaveFunction,getFunction:i=c.defaultGetFunction,disabled:o=!1}){super({id:t,disabled:o}),this.premium=e,this.saveFunction=s,this.getFunction=i,this.options=[],this.disabled=o,this.addAfterRefreshHook(()=>{for(const t of this.options)t.afterRefreshElement()})}setDisabled(t=!1){this.disabled=t;for(const e of this.options)e.setDisabled(t)}addBooleanOption(t){const e=new T({id:`${this.id}-option-${this.options.length}`,disabled:this.disabled,...t});return this.options.push(e),e}addTextAreaOption(t){const e=new V({id:`${this.id}-option-${this.options.length}`,disabled:this.disabled,...t});return this.options.push(e),e}addNumericOption(t){const e=new A({id:`${this.id}-option-${this.options.length}`,disabled:this.disabled,...t});return this.options.push(e),e}addKeyDownOption(t){const e=new D({id:`${this.id}-option-${this.options.length}`,disabled:this.disabled,...t});return this.options.push(e),e}addSelectOption(t){const e=new L({id:`${this.id}-option-${this.options.length}`,disabled:this.disabled,...t});return this.options.push(e),e}addGroupedOption({description:t,saveFunction:e=this.saveFunction,getFunction:s=this.getFunction}){const i=new R({id:`${this.id}-option-${this.options.length}`,disabled:this.disabled,description:t,saveFunction:e,getFunction:s});return this.options.push(i),i}toString(){return 0===this.options.length?`<tr id="${this.id}" style="display: none;"><td><table width="100%"><tbody></tbody></table></td></tr>`:`<tr id="${this.id}"><td><table width="100%"><tbody>${this.options.join("")}</tbody></table></td></tr>`}}class O extends u{constructor({id:t,description:e="",imageLeft:s="",imageRight:i=""}){super(t),this.backContainer="",this.description=e,this.imageLeft=s,this.imageRight=i,this.alignment="",this.frontContainer={styling:'style="display: none;"',id:"",setId(t){this.id=t},setStyle(t){this.styling=`style="${t}"`},toString:()=>""},this.frontContainer.setId(t)}addImageLeft(t){this.imageLeft=t,this.refreshElement()}addImageRight(t){this.imageRight=t,this.refreshElement()}setDescription(t){this.description=t,this.refreshElement()}setAlignment(t){this.alignment=t,this.refreshElement()}toString(){let t=`<tr id=${this.id} style=''><td><table><tbody><tr>`;return this.imageLeft&&""!==this.imageLeft&&(t=`${t}<td><img src="${this.imageLeft}"></td>`),t=""===this.alignment?""===this.imageLeft&&""===this.imageRight?`${t}<td align="left">${this.description}</td>`:`${t}<td align="center">${this.description}</td>`:`${t}<td align="${this.alignment}">${this.description}</td>`,this.imageRight&&""!==this.imageRight&&(t=`${t}<td><img src="${this.imageRight}"></td>`),`${t}</tr></tbody></table></td></tr>`}}class M extends w{constructor({id:t,heading:e,premium:s=!1,description:i="",imageLeft:o="",imageRight:r="",saveFunction:a=c.defaultSaveFunction,getFunction:n=c.defaultGetFunction,refresh:l=!0,resetButton:d=!1,presets:h=0,disabled:u=!1}){super({id:t,disabled:u}),this.heading=e,this.premium=s,this.saveFunction=a,this.getFunction=n,this.refresh=l,this.resetButton=d,this.disabled=u;const g=s?'<th class="premium">':"<th>";this.frontContainer=`<form id="${this.id}" action="none"><table style="background:url(${c.getImagePackUrl()}bgd.gif)" width="100%" cellpadding="3" align="center"><tbody><tr>${g}${e}</th></tr>`,this.backContainer="</tbody></table></form>",this.innerHtml="",this.description=new O({id:`${this.id}-description`,description:i,imageLeft:o,imageRight:r}),this.optionsGroup=new H({id:`${this.id}-options-group`,premium:s,saveFunction:a,getFunction:n,disabled:u}),this.saveButtonRow=new E({id:`${this.id}-save`,premium:s,resetButton:d,disabled:u}),this.presets=new B({id:`${this.id}-presets`,premium:s,presets:h,disabled:u}),this.addAfterRefreshHook(t=>{t.maintainRefreshStatus||(this.refresh=!0)}),this.addAfterRefreshHook(()=>{this.optionsGroup.afterRefreshElement(),this.saveButtonRow.afterRefreshElement()}),this.addAfterRefreshHook(()=>{this.setFunctions()})}toString(){return 0===this.optionsGroup.options.length?this.frontContainer+this.description+this.innerHtml+this.optionsGroup+this.backContainer:this.frontContainer+this.description+this.innerHtml+this.optionsGroup+this.saveButtonRow+this.presets+this.backContainer}setFunctions(){0!==this.optionsGroup.options.length&&(this.saveButtonRow.addSaveEventListener(()=>{for(const t of this.optionsGroup.options)t.saveValue();this.saveButtonRow.displaySaved();const t=new Event("save");this.getElement().dispatchEvent(t)}),this.saveButtonRow.addResetEventListener(()=>{for(const t of this.optionsGroup.options)t.resetValue();this.saveButtonRow.displayReset(),this.optionsGroup.refreshElement();const t=new Event("reset");this.getElement().dispatchEvent(t)})),this.presets.setFunctions(this.optionsGroup.options)}setDisabled(t=!1){this.disabled=t,this.optionsGroup.setDisabled(t),this.saveButtonRow.setDisabled(t),this.presets.setDisabled(t)}addSaveEventListener(t){return this.saveButtonRow.addSaveEventListener(t)}addBooleanOption({refresh:t=this.refresh,...e}){const s=this.optionsGroup.addBooleanOption(e);return t&&this.refreshElement(),s}addTextAreaOption({refresh:t=this.refresh,...e}){const s=this.optionsGroup.addTextAreaOption(e);return t&&this.refreshElement(),s}addNumericOption({refresh:t=this.refresh,...e}){const s=this.optionsGroup.addNumericOption(e);return t&&this.refreshElement(),s}addKeyDownOption({refresh:t=this.refresh,...e}){const s=this.optionsGroup.addKeyDownOption(e);return t&&this.refreshElement(),s}addSelectOption({refresh:t=this.refresh,...e}){const s=this.optionsGroup.addSelectOption(e);return t&&this.refreshElement(),s}addGroupedOption({description:t,saveFunction:e=this.saveFunction,getFunction:s=this.getFunction,refresh:i=this.refresh}){const o={description:t,saveFunction:e,getFunction:s},r=this.optionsGroup.addGroupedOption(o);return i&&this.refreshElement(),r}}class N extends u{constructor({id:t,content:e=null,saveFunction:s=c.defaultSaveFunction,getFunction:i=c.defaultGetFunction,refresh:o=!0,active:r=!0}){super(t),this.content=e,this.saveFunction=s,this.getFunction=i,this.leftBoxes=[],this.rightBoxes=[],this.topBoxes=[],this.bottomBoxes=[],this.refresh=o,this.active=r,this.addAfterRefreshHook(t=>{t.maintainRefreshStatus||(this.refresh=!0)}),this.addAfterRefreshHook(()=>{for(const t of this.topBoxes)t.afterRefreshElement();for(const t of this.leftBoxes)t.afterRefreshElement();for(const t of this.rightBoxes)t.afterRefreshElement();for(const t of this.bottomBoxes)t.afterRefreshElement()})}addBox({top:t=!1,bottom:e=!1,...s}){let i=null;return i=t?this.addBoxTop(s):e?this.addBoxBottom(s):this.leftBoxes.length<=this.rightBoxes.length?this.addBoxLeft(s):this.addBoxRight(s),i}addBoxBottom({refresh:t=this.refresh,...e}){const s=new M({id:`${this.id}-bottom-box-${this.bottomBoxes.length}`,refresh:t,...e});return this.bottomBoxes.push(s),t&&this.refreshElement(),s}addBoxTop({refresh:t=this.refresh,...e}){const s=new M({id:`${this.id}-top-box-${this.topBoxes.length}`,refresh:t,...e});return this.topBoxes.push(s),t&&this.refreshElement(),s}addBoxLeft({refresh:t=this.refresh,...e}){const s=new M({id:`${this.id}-left-box-${this.leftBoxes.length}`,refresh:t,...e});return this.leftBoxes.push(s),t&&this.refreshElement(),s}addBoxRight({refresh:t=this.refresh,...e}){const s=new M({id:`${this.id}-right-box-${this.rightBoxes.length}`,refresh:t,...e});return this.rightBoxes.push(s),t&&this.refreshElement(),s}addPremiumBox(t){return this.addBox({premium:!0,...t})}addPremiumBoxLeft(t){return this.addBoxLeft({premium:!0,...t})}addPremiumBoxRight(t){return this.addBoxRight({premium:!0,...t})}toString(){if(null!==this.content)return this.content;const t=this.active?"":"hidden";return`<tr id="${this.id}" ${t}><td><table width="100%" align="center"><tbody><tr><td id="${this.id}-top" colspan="3" valign="top">${this.topBoxes.join("<br><br>")}${this.topBoxes.length>0?"<br><br>":""}</td></tr><tr><td id="${this.id}-left" width="350" valign="top">${this.leftBoxes.join("<br><br>")}</td><td width="40"></td><td id="${this.id}-right" width="350" valign="top">${this.rightBoxes.join("<br><br>")}</td></tr><tr><td id="${this.id}-bottom" colspan="3" valign="top">${this.bottomBoxes.length>0?"<br><br>":""}${this.bottomBoxes.join("<br><br>")}</td></tr></tbody></table></td></tr>`}setActive(){this.active=!0,this.getElement().removeAttribute("hidden")}setInactive(){this.active=!1,this.getElement().setAttribute("hidden","")}}class q{constructor({id:t,label:e,saveFunction:s=c.defaultSaveFunction,getFunction:i=c.defaultGetFunction,refresh:o=!0,active:r=!1,padding:a}){this.id=t,this.active=r,this.label=new b({id:`${this.id}-label`,heading:e,active:this.active,padding:a}),this.content=new N({id:`${this.id}-content`,saveFunction:s,getFunction:i,refresh:o,active:this.active})}setActive(){!0!==this.active&&(this.active=!0,this.label.setActive(),this.content.setActive())}setInactive(){!1!==this.active&&(this.active=!1,this.label.setInactive(),this.content.setInactive())}afterRefreshElement(t){this.label.afterRefreshElement(t),this.content.afterRefreshElement(t)}getLabel(){return this.label}getContent(){return this.content}toString(){return this.content.toString()}}class G extends u{constructor({id:t}){super(t)}toString(){return`<tr id="${this.id}"><td align="right" style="font-size:11px;color:#696988;padding-right:7px;padding-top:5px">Version ${GM_info.script.version}</td></tr>`}}class U extends u{constructor({id:t,heading:e,defaultLabel:s="Default tab",content:i=null,saveFunction:o=c.defaultSaveFunction,getFunction:r=c.defaultGetFunction,refresh:a=!0}){super(t),this.heading=e,this.content=i,this.saveFunction=o,this.getFunction=r,this.subTabsRow=new p({id:`${this.id}-tabsrow`}),this.refresh=a,this.subTabs=[],this.defaultTab=this.addSubTab({label:s,saveFunction:this.saveFunction,getFunction:this.getFunction,refresh:!1,active:!0}),this.versionRow=new G({id:`${this.id}-versionrow`}),this.addAfterRefreshHook(t=>{t.maintainRefreshStatus||(this.refresh=!0)}),this.addAfterRefreshHook(t=>{if(this.refresh||!t.maintainRefreshStatus)for(const e of this.subTabs)e.afterRefreshElement(t)})}addSubTab({label:t,saveFunction:e=this.saveFunction,getFunction:s=this.getFunction,refresh:i=this.refresh,active:o=!1,padding:r}){const a=new q({id:`${this.id}-subtab-${this.subTabs.length}`,label:t,saveFunction:e,getFunction:s,refresh:i,active:o,padding:r}),n=a.getContent(),l=a.getLabel();return this.subTabsRow.addLabel({label:l}),this.subTabs.push(a),l.addEventListener("click",()=>{this.setActiveSubTab(a.id)}),i&&this.refreshElement(),n}setActiveSubTab(t){for(const e of this.subTabs)e.id===t?e.setActive():e.setInactive()}addBox(t){return this.defaultTab.addBox(t)}addBoxBottom(t){return this.defaultTab.addBoxBottom(t)}addBoxTop(t){return this.defaultTab.addBoxTop(t)}addBoxLeft(t){return this.defaultTab.addBoxLeft(t)}addBoxRight(t){return this.defaultTab.addBoxRight(t)}addPremiumBox(t){return this.defaultTab.addPremiumBox(t)}addPremiumBoxLeft(t){return this.defaultTab.addPremiumBoxLeft(t)}addPremiumBoxRight(t){return this.defaultTab.addPremiumBoxRight(t)}setActive(){this.getElement().removeAttribute("hidden")}setInactive(){this.getElement().setAttribute("hidden","")}toString(){if(null!==this.content)return this.content;const t=this.subTabs.length>1?"":"hidden",e=this.subTabs.length>1?'class="tabstyle"':"";return`<table id="${this.id}" hidden class="tabstyle" style="background:url(${c.getImagePackUrl()}bgdark.gif)" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div align="center"><h1>${this.heading}</h1></div></td></tr><tr><td><table width="100%" align="center" cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><table cellspacing="0" cellpadding="0" border="0" ${t}><tbody>${this.subTabsRow}</tbody></table></td></tr><tr><td><table ${e} cellspacing="0" cellpadding="0" border="0"><tbody>${this.subTabs.join("")}</tbody></table></td></tr></tbody></table></td></tr>${this.versionRow}</tbody></table>`}}class K{constructor({id:t,heading:e,content:s=null,saveFunction:i=c.defaultSaveFunction,getFunction:o=c.defaultGetFunction,refresh:r=!0,defaultLabel:a}){this.id=t,this.heading=e,this.content=new U({id:`options-content-${this.id}`,heading:e,content:s,saveFunction:i,getFunction:o,refresh:r,defaultLabel:a}),this.label=new b({id:`${this.id}-label`,heading:e}),this.active=!1,this.saveFunction=i,this.getFunction=o}addListeners(){this.getLabel().addEventListener("click",()=>c.setActiveTab(this.id),!0),window.addEventListener("storage",()=>{window.localStorage.getItem("pardusOptionsOpenTab")!==this.id||this.active||this.setActive(),window.localStorage.getItem("pardusOptionsOpenTab")!==this.id&&this.active&&this.setInactive()})}setActive(){this.label.setActive(),this.content.setActive(),this.active=!0}setInactive(){this.label.setInactive(),this.content.setInactive(),this.active=!1}getContent(){return this.content}getLabel(){return this.label}}class j{static init(){if(document.getElementById("options-area"))return;const t=document.getElementsByTagName("table")[2],e=t.parentNode;t.setAttribute("id","options-content-pardus-default"),t.setAttribute("class","tabstyle"),t.remove(),e.appendChild(this.getPardusOptionsElement());const s=this.createDefaultTipBox();e.appendChild(s.toElement()),this.addTab({id:"pardus-default",heading:"Pardus Options",content:t.outerHTML,refresh:!1}),c.setActiveTab("pardus-default")}static version(){return 1.6}static createDefaultTipBox(){return new g({id:"options-default-tip-box"})}static getDefaultTipBox(){const t=this.createDefaultTipBox();return t.refreshElement(),t}static getTabsElement(){return new f({id:"options-tabs"})}static getContentElement(){return new m({id:"options-content"})}static getPardusOptionsElement(){const t=document.createElement("template");return t.innerHTML=`<table id="options-area" cellspacing="0" cellpadding="0" border="0"><tbody><tr cellspacing="0" cellpadding="0" border="0"><td>${this.getTabsElement()}</td></tr>${this.getContentElement()}</tbody></table>`,t.content.firstChild}static addTab({id:t,heading:e,content:s=null,saveFunction:i=c.defaultSaveFunction,getFunction:o=c.defaultGetFunction,refresh:r=!0,defaultLabel:a}){const n=new K({id:t,heading:e,content:s,saveFunction:i,getFunction:o,refresh:r,defaultLabel:a});if(document.getElementById(n.id))throw new Error(`Tab '${n.id}' already exists!`);return this.getTabsElement().addLabel({label:n.getLabel()}),this.getContentElement().addContent({content:n.getContent()}),n.addListeners(),n.getContent()}}"/options.php"===document.location.pathname&&j.init(),c.addGlobalListeners();class z{constructor(t){this.number=t,this.id=`navigation-favourite-${t}`;const e=c.getVariableValue(this.id);e&&(this.name=e.name,this.value=e.value)}save(){this.name=document.getElementById(`${this.id}-name`).value,this.value={sector:document.getElementById("select-sector").value,x:document.getElementById("target-x").value,y:document.getElementById("target-y").value},c.setVariableValue(this.id,{name:this.name,value:this.value})}load(){document.getElementById("select-sector").value=this.value.sector,document.getElementById("target-x").value=this.value.x,document.getElementById("target-y").value=this.value.y}addEventListeners(){document.getElementById(`${this.id}-save`).addEventListener("click",()=>{this.save(),document.getElementById(`${this.id}-save`).setAttribute("disabled","true"),document.getElementById(`${this.id}-save`).value="Saved",document.getElementById(`${this.id}-save`).setAttribute("style","color:green;background-color:silver"),setTimeout(()=>{document.getElementById(`${this.id}-save`).removeAttribute("disabled"),document.getElementById(`${this.id}-save`).value="Save",document.getElementById(`${this.id}-save`).setAttribute("style","color:#D0D1D9;background-color:#00001C;")},2e3)}),document.getElementById(`${this.id}-load`).addEventListener("click",()=>{this.load(),document.getElementById(`${this.id}-load`).setAttribute("disabled","true"),document.getElementById(`${this.id}-load`).value="Loaded",document.getElementById(`${this.id}-load`).setAttribute("style","color:green;background-color:silver"),setTimeout(()=>{document.getElementById(`${this.id}-load`).removeAttribute("disabled"),document.getElementById(`${this.id}-load`).value="Load",document.getElementById(`${this.id}-load`).setAttribute("style","color:#D0D1D9;background-color:#00001C;")},2e3)})}#k(){return`<input value="Save" id="${this.id}-save" tabindex='-1' type="button" style="color:#D0D1D9;background-color:#00001C;"/>`}#T(){return`<input value="Load" id="${this.id}-load" tabindex='-1' type="button" style="color:#D0D1D9;background-color:#00001C;"/>`}#V(){let t=`placeholder='Favourite ${this.number}'`;return"value"in this&&(t=`value='${this.name}'`),`<input id='${this.id}-name' type='text' tabindex='-1' ${t} style='color:#D0D1D9; background-color:#00001C;width:120px;'></input>`}toString(){return`<tr><td align='left'>${this.#V()}</td><td align='right'>${this.#T()} ${this.#k()}</td></tr>`}}class W{constructor(){this.id="pardus-flight-computer-navigation-calculator-favourites",this.numberOfFavourites=c.getVariableValue("navigation_number_of_favourites",4),this.favourites=[],this.setupFavourites()}setupFavourites(){for(let t=1;t<=this.numberOfFavourites;t+=1)this.favourites.push(new z(t))}addEventListeners(){for(const t of this.favourites)t.addEventListeners()}toString(){return this.getHtml()}getInnerHtml(){let t="";for(const e of this.favourites)t+=e;return t}getHtml(){return`<table id='${this.id}' style='width: 100%;'><tbody>${this.getInnerHtml()}</tbody></table>`}}function Z(t,e){return`http://map.xcom-alliance.info/${encodeURI(t)}.html?hilite=${e.join("|")}`}function J(t){if(t<=10)return 2500;if(t>=85.9)return 1e3;const e=t-10;return 1e3+10*Math.floor(150*10**(-.019*e)-e**(1/3))}class Q{constructor(t={squad:!1}){this.isSquad=t.squad,this.id="pardus-flight-computer-navigation-calculator-configuration",this.configuration=c.getVariableValue("navigation-configuration",{}),this.#A()}saveConfiguration(){c.setVariableValue("navigation-configuration",this.configuration)}getOptions(){const t={drive_speed:1,navigation_level:0,amber_stim:!1,pathfinder:null,wormhole_cost:10,x_hole_cost:1e3,exocrab:!1,boost_active:!1,gas_flux_capacitor:null,energy_flux_capacitor:null,wormhole_seals:{enif:!0,nhandu:!0,procyon:!0,quaack:!0}},e=(Date.now()-1449120361e3)/1e3/60/60/24,s=["procyon","nhandu","enif","quaack"];switch(c.getUniverse()){case"artemis":case"orion":t.wormhole_seals[s[Math.floor(e/2)%4]]=!1;break;case"pegasus":t.wormhole_seals[s[Math.floor((e+3)/2)%4]]=!1;break;default:throw new Error("Unable to determine universe")}return this.isSquad?(t.drive_speed=2,t.x_hole_cost=1/0,t):("drive"in this.configuration&&(t.drive_speed=this.configuration.drive.speed),"navigation_level"in this.configuration&&(t.navigation_level=this.configuration.navigation_level),"gyro"in this.configuration&&(t.wormhole_cost=this.configuration.gyro.wormhole_cost),"gas_flux_capacitor"in this.configuration&&(t.gas_flux_capacitor=this.configuration.gas_flux_capacitor.strength),"energy_flux_capacitor"in this.configuration&&(t.energy_flux_capacitor=this.configuration.energy_flux_capacitor.strength),"effective_maneuver"in this.configuration&&(t.x_hole_cost=J(this.configuration.effective_maneuver)),"pathfinder"in this.configuration&&(t.pathfinder=this.configuration.pathfinder),t)}refreshOptions(){return Promise.all([this.#S(),this.#P(),this.#I(),this.#D()]).then(()=>{this.saveConfiguration()}).then(()=>{this.reloadHtml()})}#I(){return this.#L("overview_stats.php").then(t=>{const e=Number(t.getElementById("maneuver_actual").childNodes[0].textContent);this.configuration.effective_maneuver=e})}#D(){return this.#L("inspect_crew.php").then(t=>{const e=t.querySelectorAll(".messagestyle");let s=!1;for(const t of e){if(-1!==t.innerText.search(/Primary ability:\s*Pathfinder/)){this.configuration.pathfinder="primary",s=!0;break}if(-1!==t.innerText.search(/Secondary ability:\s*Pathfinder/)){this.configuration.pathfinder="secondary",s=!0;break}}s||(this.configuration.pathfinder=null)})}#P(){return this.#L("overview_advanced_skills.php").then(t=>{const e=t.querySelectorAll(".messagestyle"),s=e[e.length-1],i=s.rows[s.rows.length-1],o=Number(i.cells[2].innerText.split(" ")[1].split("/")[0]);this.configuration.navigation_level=o})}#S(){return this.#L("overview_ship.php").then(t=>{const e=t.querySelectorAll(".messagestyle"),s=e[0];let i;for(const t of s.rows)"Drive:"===t.cells[0].innerText&&(i=t);if(!i)throw new Error("Failed to identify the row of the ship's drive.");const o=i.querySelector("td:nth-of-type(2)"),r=o.children[0].src.split("/")[o.children[0].src.split("/").length-1];this.configuration.drive=this.driveMap.get(r);const a=e[1].querySelectorAll("img");delete this.configuration.gyro,delete this.configuration.gas_flux_capacitor,delete this.configuration.energy_flux_capacitor;for(const t of a){switch(t.src.split("/")[t.src.split("/").length-1]){case"gyro_stabilizer_1.png":this.configuration.gyro={name:"I",image:"gyro_stabilizer_1.png",wormhole_cost:6};break;case"gyro_stabilizer_2.png":this.configuration.gyro={name:"II",image:"gyro_stabilizer_2.png",wormhole_cost:1};break;case"flux_capacitor_gas.png":this.configuration.gas_flux_capacitor={name:"Weak",image:"flux_capacitor_gas.png",strength:"weak"};break;case"flux_capacitor_gas_strong.png":this.configuration.gas_flux_capacitor={name:"Strong",image:"flux_capacitor_gas_strong.png",strength:"strong"};break;case"flux_capacitor_energy.png":this.configuration.energy_flux_capacitor={name:"Weak",image:"flux_capacitor_energy.png",strength:"weak"};break;case"flux_capacitor_energy_strong.png":this.configuration.energy_flux_capacitor={name:"Strong",image:"flux_capacitor_energy_strong.png",strength:"strong"}}}})}#A(){this.driveMap=new Map,this.driveMap.set("drive_nuclear.png",{name:"Nuclear",image:"drive_nuclear.png",speed:1}),this.driveMap.set("drive_fusion.png",{name:"Fusion",image:"drive_fusion.png",speed:2}),this.driveMap.set("drive_fusion_enhanced.png",{name:"Enhanced Fusion",image:"drive_fusion_enhanced.png",speed:2}),this.driveMap.set("drive_ion.png",{name:"Ion",image:"drive_ion.png",speed:3}),this.driveMap.set("drive_ion_z.png",{name:"Z Series Ion",image:"drive_ion_z.png",speed:3}),this.driveMap.set("drive_antimatter.png",{name:"Anti-Matter",image:"drive_antimatter.png",speed:4}),this.driveMap.set("drive_antimatter_enhanced.png",{name:"Enhanced Anti-Matter",image:"drive_antimatter_enhanced.png",speed:4}),this.driveMap.set("drive_hyper.png",{name:"Hyper",image:"drive_hyper.png",speed:5}),this.driveMap.set("drive_hyper_z.png",{name:"Z Series Hyper",image:"drive_hyper_z.png",speed:5}),this.driveMap.set("drive_interphased.png",{name:"Interphased",image:"drive_interphased.png",speed:6}),this.driveMap.set("drive_interphased_enhanced.png",{name:"Enhanced Interphased",image:"drive_interphased_enhanced.png",speed:6}),this.driveMap.set("fer_drive_1.png",{name:"Feral Spin Apparatus",image:"fer_drive_1.png",speed:6})}reloadHtml(){this.isSquad?document.getElementById(this.id).innerHTML=this.getSquadInnerHtml():(document.getElementById(this.id).innerHTML=this.getInnerHtml(),this.addRefreshListener())}#L(t){return fetch(t).then(t=>{if(!t.ok)throw Error(t.statusText);return t.text()}).then(t=>(new DOMParser).parseFromString(t,"text/html"))}getSquadInnerHtml(){return`<tbody><tr><td>Drive:</td><td id='navigation-options-drive'>${`<img src='${c.getImagePackUrl()}squadrons/bomber_squad_3.png' width='32' height='10'/> Bomber squad`}</td></tr></tbody>`}getInnerHtml(){return`<tbody><tr><td>Drive: </td><td id='navigation-options-drive'>${"drive"in this.configuration?`<img src='${c.getImagePackUrl()}equipment/${this.configuration.drive.image}' width='32' height='10'/> ${this.configuration.drive.name}`:"None"}</td></tr><tr><td>Navigation skill: </td><td id='navigation-options-skill'>${"navigation_level"in this.configuration?`Level ${this.configuration.navigation_level}/3`:"Level 0/3"}</td></tr><tr><td>Gyro Stabilizer: </td><td id='navigation-options-gyro'>${"gyro"in this.configuration?`<img src='${c.getImagePackUrl()}equipment/${this.configuration.gyro.image}' width='32' height='10'/> ${this.configuration.gyro.name}`:"None"}</td></tr><tr><td>Gas Flux Capacitor: </td><td id='navigation-options-gas'>${"gas_flux_capacitor"in this.configuration?`<img src='${c.getImagePackUrl()}equipment/${this.configuration.gas_flux_capacitor.image}' width='32' height='10'/> ${this.configuration.gas_flux_capacitor.name}`:"None"}</td></tr><tr><td>Energy Flux Capacitor: </td><td id='navigation-options-energy'>${"energy_flux_capacitor"in this.configuration?`<img src='${c.getImagePackUrl()}equipment/${this.configuration.energy_flux_capacitor.image}' width='32' height='10'/> ${this.configuration.energy_flux_capacitor.name}`:"None"}</td></tr><tr><td>X/Y-hole jump cost: </td><td id='navigation-options-xyhole'>${"effective_maneuver"in this.configuration?`${J(this.configuration.effective_maneuver)} <img src='${c.getImagePackUrl()}turns.png' width='9.5'/>`:`2,500 <img src='${c.getImagePackUrl()}turns.png' width='9.5'/>`}</td></tr><tr><td>Pathfinder: </td><td id='navigation-options-pathfinder'>${"pathfinder"in this.configuration&&this.configuration.pathfinder?`${this.configuration.pathfinder}`:"None"}</td></tr><tr><td colspan='2' align='center'><input id='refresh-navigation-options' type='submit' tabindex='-1' value='Refresh'/></td></tr></tbody>`}addRefreshListener(){const t=document.getElementById("refresh-navigation-options");t&&t.addEventListener("click",()=>{t.setAttribute("disabled","true"),t.value="Refreshing...",t.setAttribute("style","text-align: center; color: green; background-color: silver"),this.refreshOptions().finally(()=>{t.removeAttribute("disabled"),t.value="Plot route",t.setAttribute("style","text-align: center;")})})}toString(){return this.getHtml()}getHtml(){return this.isSquad?`<table id='${this.id}' style='width: 100%;'>${this.getSquadInnerHtml()}</table>`:`<table id='${this.id}' style='width: 100%;'>${this.getInnerHtml()}</table>`}}class X{constructor(t={squad:!1,apCalculatorBaseUrl:"https://pardusapcalculator.uk"}){this.isSquad=t.squad,this.id="pardus-flight-computer-navigation-calculator-popup",this.navigationOptions=new Q(t),this.navigationFavourites=new W,this.apCalculatorBaseUrl=t.apCalculatorBaseUrl||"https://pardusapcalculator.uk",document.getElementById(this.id)?this.element=document.getElementById(this.id):this.#R()}isVisible(){return!this.element.style.display}show(){this.element.style.display="",document.getElementById("select-sector").focus()}hide(){this.element.style.display="none",document.getElementById("select-sector").blur()}#H(t){let e=`<select id='select-${t}'><option value='' disabled selected>-- Target Sector --</option>`;for(const t of a)e+=`<option value="${t[0]}">${t[0]}</option>`;return e+="</select>",e}#O(){this.element.addEventListener("keydown",t=>{t.stopPropagation()})}getRouteFrom(t){const e=document.getElementById("select-sector").value,s=Number(document.getElementById("target-x").value),i=Number(document.getElementById("target-y").value),o=a.getTileIdFromSectorAndCoords(e,s,i);return this.#M([t,o])}#M(t=[]){const e=this.navigationOptions.getOptions();return fetch(`${this.apCalculatorBaseUrl}/route?${new URLSearchParams({waypoints:t.join(","),options:encodeURIComponent(JSON.stringify(e))})}`).then(t=>{if(!t.ok)throw Error(t.statusText);return t.json()}).then(t=>t.path)}#R(){this.element=document.createElement("div"),this.element.id=this.id;Object.assign(this.element.style,{backgroundColor:"#00002C",border:"2px outset #335",left:"50%",top:"35%",width:"520px",marginLeft:"-260px",marginTop:"-87.5px",position:"fixed",zIndex:9,display:"none"}),this.element.innerHTML=`<table style='width: inherit;'><tbody><tr><th colspan='2'>Navigate to destination</th></tr><tr style='height: 50px;'><td style='text-align: center;'><label for='select-sector'>Sector: </label>${this.#H("sector")}</td><td style='text-align: center;'><label for='target-x'>x: <input id='target-x' type='number' min=0 max=100 maxlength=3 size=3/> <label for='target-y'>y: <input id='target-y' type='number' min=0 max=100 maxlength=3 size=3/></td></tr><tr><td id='destination-favourites' style='width: 50%;padding: 5px;border-style: dotted;border-color: gray;border-width: thin;'>${this.navigationFavourites}</td><td id='navigation-ship-equipment' style='width: 50%;padding: 5px;border-style: dotted;border-color: gray;border-width: thin;'>${this.navigationOptions.getHtml()}</td></tr><tr><td colspan='2' style='text-align: center;padding-top:20px;'><input type='submit' id='navigate-to-destination' value='Plot route'/></td></tr><tr><td colspan='2' style='text-align: right;'><input type='submit' id='close-navigation-calculator-popup' value='Cancel'/></td></tr></tbody></table>`,document.body.appendChild(this.element),document.getElementById("close-navigation-calculator-popup").addEventListener("click",()=>{this.hide()}),this.#O(),this.navigationOptions.addRefreshListener(),this.navigationFavourites.addEventListeners()}getCalculateButtonElement(){return document.getElementById("navigate-to-destination")}}class Y{#N=new Map;constructor(t,e,s){this.navArea=t,this.optionsPrefix=e,this.isSquad=s,this.apCalculatorBaseUrl=c.getVariableValue("ap_calculator_base_url","https://pardusapcalculator.uk"),this.tileString=c.getVariableValue(`${this.optionsPrefix}tiles_to_highlight`,""),this.defaultColour=c.getVariableValue(`${this.optionsPrefix}default_colour`,"g"),this.tileMap=new Map;for(const t of this.tileString.split(",")){const e=t.split("|");1===e.length?this.tileMap.set(e[0],this.defaultColour):this.tileMap.set(e[0],e[1])}this.#q(),this.#G(),document.addPardusKeyDownListener("toggle_recording_keypress",{code:82},this.#U),this.#K(),this.navArea.addAfterRefreshHook(()=>{this.#K()})}#K(){this.navArea.addTilesHighlight(this.tileMap),this.isSquad||(this.#j(),this.#z()),this.#W()}#z(){if(this.isSquad)return;if(!c.getVariableValue(`${this.optionsPrefix}highlight_tiles`,!0))return;const t=c.getVariableValue("recorded_tile_colour","c"),e=c.getVariableValue("bad_recorded_tile_colour","r"),s=new Map(c.getVariableValue("recorded_tiles",[]).map(e=>[e,t])),i=new Map(c.getVariableValue("bad_recorded_tiles",[]).map(t=>[t,e]));this.navArea.addTilesHighlight(s),this.navArea.addTilesHighlight(i)}#W(){for(const t of this.navArea.navigatableTiles()){const e=this.navArea.getPathTo(t);if(t.addEventListener("mouseenter",()=>{for(const t of e)t.path_highlighted||(t.path_highlighted=!0,t.isHighlighted()?t.emphasiseHighlight():t.addHighlight(c.getVariableValue("default_path_colour","y")))},{nonce:`path_finding_mouseenter_${t.id}`}),t.addEventListener("mouseleave",()=>{for(const t of e)t.isEmphasised()?t.removeEmphasis():t.removeHighlight(c.getVariableValue("default_path_colour","y")),t.path_highlighted=!1},{nonce:`path_finding_mouseleave_${t.id}`}),t.element.querySelector(":hover"))for(const t of e)t.path_highlighted||(t.path_highlighted=!0,t.isHighlighted()?t.emphasiseHighlight():t.addHighlight(c.getVariableValue("default_path_colour","y")))}}#U(){const t=c.getVariableValue("recording",!1);t?(et.sendMessage("Recording stopped","info"),c.setVariableValue("expected_route",[])):et.sendMessage("Recording started","info"),c.setVariableValue("recording",!t)}#j(){const t=userloc.toString(),e=c.getVariableValue("expected_route",[]),s=c.getVariableValue("recording_mode","all"),i=c.getVariableValue("recording",!1),o=c.getVariableValue(`${this.optionsPrefix}modify_route`,!1);if(i||o){const r=new Set(c.getVariableValue("recorded_tiles",[])),a=new Set(c.getVariableValue("bad_recorded_tiles",[])),n=c.getVariableValue("modified_route",[]);if(e.includes(t))for(const l of e)if(!i||"all"!==s&&"good"!==s||r.add(l),o&&n.indexOf(l)<0&&n.push(l),a.delete(l),l===t)break;c.setVariableValue("recorded_tiles",Array.from(r)),c.setVariableValue("bad_recorded_tiles",Array.from(a)),c.setVariableValue("modified_route",n)}this.#Z()}#Z(){for(const t of this.navArea.navigatableTiles()){const e=this.navArea.getPathTo(t).map(t=>t.id),s=()=>{const t=userloc.toString(),s=c.getVariableValue("recording",!1),i=c.getVariableValue(`${this.optionsPrefix}modify_route`,!1);(s||i)&&(c.setVariableValue("expected_route",e),t&&c.setVariableValue("last_tile_id",t))};t.addEventListener("click",s,{nonce:`recording_${t.id}`})}}fly(){if(c.getVariableValue(`${this.optionsPrefix}modify_route`,!1))return et.sendMessage("Modifying route, cannot use autopilot","error"),!1;const t=c.getVariableValue(`${this.optionsPrefix}tiles_to_highlight`,""),e=[],s=c.getVariableValue("autopilot_check_for_npcs",!0);for(const s of t.split(","))e.push(s.split("|")[0]);if(0===e.length)return et.sendMessage("No autopilot path programmed","error"),!1;const i=c.getVariableValue(`${this.optionsPrefix}autopilot_forward`,!0),o=c.getVariableValue(`${this.optionsPrefix}autopilot_max_steps`,10),r=e;i||r.reverse();const n=this.navArea.centreTile.id,l=r.indexOf(n);if(l<0)return et.sendMessage("You are not on the autopilot path","error"),!1;if(l===r.length-1)return et.sendMessage("Autopilot has reached the end of the path","info"),!1;let d=0;for(let t=1;t<=o&&!(l+t>r.length-1);t+=1){const e=this.navArea.getTileOnNav(r[l+t]);if(!e)break;if(s&&e.hasNpc())break;const i=this.navArea.getPathTo(e);if(i.length<=1)break;const o=r.slice(l,l+1+t);if(JSON.stringify(i.map(t=>t.id))!==JSON.stringify(o))break;d=t}return d>0?(c.setVariableValue("expected_route",r.slice(l,l+d+1)),this.navArea.nav(r[l+d])):s&&l+d<r.length-1&&this.navArea.getTileOnNav(r[l+d+1])?.hasNpc()?(et.sendMessage("NPC is in the way, please fly around","error"),!1):this.navArea.centreTile.isWormhole()?this.navArea.warp(r[l]):this.navArea.centreTile.isXHole()||this.navArea.centreTile.isYHole()?this.navArea.xhole(r[l+1]):(et.sendMessage(`Unable to fly to ${a.getSectorAndCoordsForTile(r[l+1])}, please make sure the route is continuous.`,"error"),!1)}#q(){c.getVariableValue(`${this.optionsPrefix}enable_autopilot`,!0)&&(document.addPardusKeyDownListener("move_along_path_key",{code:70},()=>{this.fly()}),document.addPardusKeyDownListener("modify_autopilot_route",{code:77},()=>{const t=c.getVariableValue(`${this.optionsPrefix}modify_route`,!1);if(c.setVariableValue(`${this.optionsPrefix}modify_route`,!t),t){const t=c.getVariableValue("modified_route",[]);if(t.length<2)return void et.sendMessage("Cancelling route modification","info");const e=c.getVariableValue(`${this.optionsPrefix}autopilot_forward`,!0),s=c.getVariableValue(`${this.optionsPrefix}tiles_to_highlight`,""),i=[];for(const t of s.split(","))i.push(t.split("|")[0]);e||i.reverse();const o=i.indexOf(t[0]),r=i.indexOf(t[t.length-1]);if(o<0||r<0)return void et.sendMessage("Route modification must start and end on the existing route","error");o>r?i.splice(r,o+1-r,...t.reverse()):i.splice(o,r+1-o,...t),e||i.reverse(),c.setVariableValue(`${this.optionsPrefix}tiles_to_highlight`,i.join(",")),this.tileMap=new Map;for(const t of i)this.tileMap.set(t.toString(),this.defaultColour);this.navArea.clearTilesHighlights(),this.navArea.addTilesHighlight(this.tileMap),this.#z(),et.sendMessage("Saving route","info")}else et.sendMessage("Modifying route","info"),c.setVariableValue("modified_route",[this.navArea.centreTile.id])}),document.addPardusKeyDownListener("toggle_autopilot_direction",{code:67},()=>{if(c.getVariableValue(`${this.optionsPrefix}modify_route`,!1))return void et.sendMessage("Cannot change autopilot direction whilst modifying path","error");const t=c.getVariableValue(`${this.optionsPrefix}autopilot_forward`,!1);t?et.sendMessage("Autopilot heading backwards","info"):et.sendMessage("Autopilot heading forward","info"),c.setVariableValue(`${this.optionsPrefix}autopilot_forward`,!t)}))}#J(t){this.navigationCalculatorPopup.isVisible()&&(t.preventDefault(),this.navigationCalculatorPopup.getCalculateButtonElement().setAttribute("disabled","true"),this.navigationCalculatorPopup.getCalculateButtonElement().value="Plotting...",this.navigationCalculatorPopup.getCalculateButtonElement().setAttribute("style","text-align: center; color: green; background-color: silver"),this.navigationCalculatorPopup.getRouteFrom(this.navArea.centreTile.id).then(t=>{c.setVariableValue(`${this.optionsPrefix}tiles_to_highlight`,t.join(",")),c.setVariableValue(`${this.optionsPrefix}autopilot_forward`,!0),c.setVariableValue(`${this.optionsPrefix}modify_route`,!1),this.navigationCalculatorPopup.hide(),et.sendMessage("Plotted route to destination","info"),this.tileMap=new Map;for(const e of t)this.tileMap.set(e.toString(),this.defaultColour);this.navArea.clearTilesHighlights(),this.navArea.addTilesHighlight(this.tileMap),this.#z()}).catch(()=>{et.sendMessage("Unable to get route to destination","error")}).finally(()=>{this.navigationCalculatorPopup.getCalculateButtonElement().removeAttribute("disabled"),this.navigationCalculatorPopup.getCalculateButtonElement().value="Plot route",this.navigationCalculatorPopup.getCalculateButtonElement().setAttribute("style","text-align: center;")}))}#G(){this.navigationCalculatorPopup=new X({squad:this.isSquad,apCalculatorBaseUrl:this.apCalculatorBaseUrl}),document.addPardusKeyDownListener("open_navigation_key",{code:68},t=>{this.navigationCalculatorPopup.isVisible()||(this.navigationCalculatorPopup.show(),t.preventDefault())}),document.addPardusKeyDownListener("close_navigation_key",{code:27},t=>{this.navigationCalculatorPopup.isVisible()&&(this.navigationCalculatorPopup.hide(),t.preventDefault())}),this.navigationCalculatorPopup.element.addPardusKeyDownListener("close_navigation_key",{code:27},t=>{this.navigationCalculatorPopup.isVisible()&&(this.navigationCalculatorPopup.hide(),t.preventDefault())}),this.navigationCalculatorPopup.element.addPardusKeyDownListener("plot_key",{code:13},t=>{this.#J(t)}),this.navigationCalculatorPopup.getCalculateButtonElement().addEventListener("click",t=>{this.#J(t)})}}class tt{constructor(t){this.squad=t.squad,this.optionsPrefix=this.squad?"squads_":"",this.nav=new Y(t.nav,this.optionsPrefix,this.squad)}}class et{constructor(){this.centreTd=document.querySelector('td[align="center"]'),window.parent&&window.parent.window.addEventListener("pardus-message",t=>{this.addMessage(t.detail.msg,t.detail.type)})}hasMessage(){return!!this.centreTd.querySelector("table")}addMessage(t,e){let s,i;if("error"===e)s="gnome-error",i="#FF3300";else s="gnome-info",i="#CCCCCC";this.#Q(t,s,i)}#Q(t,e,s){const i=`<table style="background-image:url(${c.getImagePackUrl()}bgmedium.gif);border-style:ridge;border-color:#2b2b51;border-width:2px;" cellspacing="0" cellpadding="0" align="center"><tbody><tr><td><img src="${c.getImagePackUrl()}${e}.png" alt="" width="32" height="32"></td><td style="padding-left:2px;padding-right:4px;"><font style="font-weight:bold;font-size:13px;" color="${s}"> ${t}</font></td></tr></tbody></table>`;this.centreTd.innerHTML=i}addErrorMessage(t){this.addMessage(t,"error")}static sendMessage(t,e){return window.parent?window.parent.window.dispatchEvent(new CustomEvent("pardus-message",{detail:{msg:t,type:e}})):window.dispatchEvent(new CustomEvent("pardus-message",{detail:{msg:t,type:e}}))}}class st{constructor(){this.pardusFlightComputerTab=j.addTab({heading:"Flight Computer",id:"flight-computer",defaultLabel:"Route Highlight"}),this.pathHighlightingSubtab=this.pardusFlightComputerTab.addSubTab({label:"Path Highlight"}),this.recordingSubtab=this.pardusFlightComputerTab.addSubTab({label:"Recording"}),this.routeCalculatorSubtab=this.pardusFlightComputerTab.addSubTab({label:"Route Calculator"}),this.squadsSubtab=this.pardusFlightComputerTab.addSubTab({label:"Squads"}),this.coloursSelection=[];for(const t of i.colours)this.coloursSelection.push({value:t[1].short_code,text:t[0],style:`background-color:rgb(${t[1].red},${t[1].green},${t[1].blue})`});this.routeHighlightingOptions(this.pardusFlightComputerTab),this.pathHighlightingOptions(this.pathHighlightingSubtab),this.recordingOptions(this.recordingSubtab),this.routeCalculatorOptions(this.routeCalculatorSubtab),this.squadsOptions(this.squadsSubtab),this.pardusFlightComputerTab.refreshElement()}pathHighlightingOptions(t){t.addBoxTop({heading:"Path Highlighting",description:"Path highlighting shows the path your ship will fly to a particular tile."});const e=t.addBox({heading:"General Options",description:"These are the general options for path highlighting."});e.addBooleanOption({variable:"show_pathing",description:"Enable path highlighting",defaultValue:!0}),e.addSelectOption({variable:"default_path_colour",description:"Colour for path highlighting",options:this.coloursSelection,inheritStyle:!0,defaultValue:"y"})}routeHighlightingOptions(t){t.addBoxTop({heading:"Route Highlighting",description:"Route highlighting shows a pre-defined route on the nav screen. The route may consist of multiple disjoint and isolated tiles."});const e=t.addBox({heading:"General Options",description:"These are the general options for route highlighting."});e.addBooleanOption({variable:"highlight_tiles",description:"Enable route highlighting",defaultValue:!0,info:{title:"Route Highlighting",description:"Enabling route highlighting will show the route on the nav screen corresponding to the route in the route tiles box. This option does not enable or disable the autopilot functionality."}}),e.addSelectOption({variable:"default_colour",description:"Default colour for route highlighting",options:this.coloursSelection,defaultValue:"g",inheritStyle:!0,info:{title:"Route Highlighting Colour",description:"This option specifies the colour that is used to highlight tiles on the route when no colour is specified alongside the tile id. The colour of individual tiles may be overriden by specifying <code>{tile_id}|{colour}</code> within the route box, where colours are denoted by one of <code>g</code>, <code>r</code>, <code>b</code>, or <code>y</code>."}});const s=t.addBox({heading:"Route Tiles",description:"This is the list of tiles forming the route to highlight. If you are using autopilot, please ensure the tiles create a continuous path, and are ordered sequentially from one end to the other.",resetButton:!0,presets:4});s.addTextAreaOption({variable:"tiles_to_highlight",defaultValue:"",cols:64,rows:3});const i=t.addBoxLeft({heading:"Autopilot Options",description:"These are the general options for autopilot. Autopilot will attempt to fly along the route configured in the route tiles box, ensuring that it only travels over tiles contained in the route. If the route configured is not continuous, autopilot will fly to the end of the current continuous section and stop. Autopilot will only work when you are somewhere along the route; one tile off and autopilot will not move."});i.addBooleanOption({variable:"enable_autopilot",description:"Enable autopilot",defaultValue:!0,info:{title:"Autopilot",description:"Enabling autopilot will allow you to fly along the route configured in the route tiles box using the key configured for flying. It is recommended to enable route highlighting with the autopilot, so you can visually see the route the autopilot will fly. This option does not enable or disable the route highlighting functionality."}}),i.addBooleanOption({variable:"autopilot_forward",description:"Forward direction",defaultValue:!0,info:{title:"Autopilot Direction",description:"This setting determines the direction autopilot will fly in for the configured route in the route tiles box. Forwards will fly from the first tile to the last tile in the route tiles box, and backwards will fly from the last to the first. This setting can be changed using the configured key to change direction."}}),i.addBooleanOption({variable:"autopilot_check_for_npcs",description:"Check for NPCs",defaultValue:!0,info:{title:"Check for NPCs",description:"This setting determines whether autopilot will check for NPCs on the route, and stop before landing on them. Disabling this option will make the autopilot attempt to fly through NPCs."}}),i.addNumericOption({variable:"autopilot_max_steps",description:"Maximum steps",defaultValue:8,min:1,max:8,info:{title:"Autopilot Steps",description:"The maximum number of tiles autopilot will fly over every keypress. The maximum achievable is 8 tiles, allowing you to fly as far as you can see on your nav. The minimum is 1, and will allow you to fly one tile at a time."}}),i.addKeyDownOption({variable:"move_along_path_key",description:"Fly to the next tile",defaultValue:{code:70,key:"KeyF",description:"f"},info:{title:"Autopilot Fly Key",description:"Every press, autopilot will fly along the route configured. Disabling this option will prevent autopilot from working. It is recommended to check this key does not conflict with any other scripts."}}),i.addKeyDownOption({variable:"toggle_autopilot_direction",description:"Change direction",defaultValue:{code:67,key:"KeyC",description:"c"},info:{title:"Change Direction Key",description:"Changes the direction autopilot will fly in from the nav screen. Disabling this option will require you to come into this settings page and change the direction setting manually. It is recommended to check this key does not conflict with any other scripts."}}),i.addKeyDownOption({variable:"modify_autopilot_route",description:"Modify route",defaultValue:{code:77,key:"KeyM",description:"m"},info:{title:"Modify Route Key",description:"Temporarily adjust the route, and press the key a second time to stop."}});const o=t.addBoxBottom({heading:"Mapper",description:"The links below let you view the currently-stored route."});o.innerHtml=st.getMapperBoxHtml(),s.addEventListener("save",()=>{o.innerHtml=st.getMapperBoxHtml(),o.refreshElement()}),s.addEventListener("preset-load",()=>{o.innerHtml=st.getMapperBoxHtml(),o.refreshElement()}),s.addEventListener("reset",()=>{o.innerHtml=st.getMapperBoxHtml(),o.refreshElement()})}routeCalculatorOptions(t){t.addBoxTop({heading:"Route Highlighting",description:'Route calculator will calculator an AP-efficient route from your current location to your target destination. Using the calculator will require the script accessing non-Pardus websites, which perform the calculations remotely. For more fine-grained control, please use <a href="https://tro.xcom-alliance.info/path_calculator.html" target="_blank">https://tro.xcom-alliance.info/path_calculator.html</a>.'});const e=t.addBox({heading:"General Options",description:"These are the general options for the route calculator."});e.addKeyDownOption({variable:"open_navigation_key",description:"Open navigation box",defaultValue:{code:68,key:"KeyD",description:"d"},info:{title:"Navigation Box",description:"This button opens the navigation box. It can be closed by pressing the escape key, or by clicking the cancel button. Disabling this option effectively disables the nagivation calculator."}}),e.addNumericOption({variable:"navigation_number_of_favourites",description:"Number of favourites",defaultValue:4,min:1,max:10})}squadsOptions(t){t.addBoxTop({heading:"Sqauds Route Highlighting",description:"Squads route highlighting shows a pre-defined route on the nav screen for squads. The route may consist of multiple disjoint and isolated tiles."});const e=t.addBox({heading:"General Options",description:"These are the general options for route highlighting."});e.addBooleanOption({variable:"squads_highlight_tiles",description:"Enable sqauds route highlighting",defaultValue:!0}),e.addSelectOption({variable:"sqauds_default_colour",description:"Default colour for sqauds route highlighting",options:this.coloursSelection,defaultValue:"g",inheritStyle:!0,info:{title:"Route Highlighting Colour",description:"This option specifies the colour that is used to highlight tiles on the route when no colour is specified alongside the tile id. The colour of individual tiles may be overriden by specifying <code>{tile_id}|{colour}</code> within the route box, where colours are denoted by one of <code>g</code>, <code>r</code>, <code>b</code>, or <code>y</code>."}});const s=t.addBox({heading:"Route Tiles",description:"This is the list of tiles forming the route to highlight.",resetButton:!0,presets:4});s.addTextAreaOption({variable:"squads_tiles_to_highlight",defaultValue:"",cols:64,rows:3});const i=t.addBoxLeft({heading:"Autopilot Options",description:"These are the general options for autopilot. Autopilot will attempt to fly along the route configured in the route tiles box, ensuring that it only travels over tiles contained in the route. If the route configured is not continuous, autopilot will fly to the end of the current continuous section and stop. Autopilot will only work when you are somewhere along the route; one tile off and autopilot will not move."});i.addBooleanOption({variable:"squads_enable_autopilot",description:"Enable autopilot",defaultValue:!0,info:{title:"Autopilot",description:"Enabling autopilot will allow you to fly along the route configured in the route tiles box using the key configured for flying. It is recommended to enable route highlighting with the autopilot, so you can visually see the route the autopilot will fly. This option does not enable or disable the route highlighting functionality."}}),i.addBooleanOption({variable:"squads_autopilot_forward",description:"Forward direction",defaultValue:!0,info:{title:"Autopilot Direction",description:"This setting determines the direction autopilot will fly in for the configured route in the route tiles box. Forwards will fly from the first tile to the last tile in the route tiles box, and backwards will fly from the last to the first. This setting can be changed using the configured key to change direction."}}),i.addNumericOption({variable:"squads_autopilot_max_steps",description:"Maximum steps",defaultValue:8,min:1,max:8,info:{title:"Autopilot Steps",description:"The maximum number of tiles autopilot will fly over every keypress. The maximum achievable is 8 tiles, allowing you to fly as far as you can see on your nav. The minimum is 1, and will allow you to fly one tile at a time."}});const o=t.addBoxBottom({heading:"Mapper",description:"The links below let you view the currently-stored route."});o.innerHtml=st.getMapperBoxHtml(!0),s.addEventListener("save",()=>{o.innerHtml=st.getMapperBoxHtml(!0),o.refreshElement()}),s.addEventListener("reset",()=>{o.innerHtml=st.getMapperBoxHtml(!0),o.refreshElement()})}recordingOptions(t){t.addBoxTop({heading:"Recording",description:"Recording allows you to record the all the tiles you fly on and over, and provides the list of tile ids for sharing with others."});const e=t.addBox({heading:"General Options",description:"These are the general options for recording routes."});e.addBooleanOption({variable:"colour_recorded_tiles",description:"Highlight recorded tiles as you fly",defaultValue:!0}),e.addSelectOption({variable:"recording_mode",description:"Record tiles",options:[{value:"all",text:"All tiles",default:!0},{value:"bad",text:"Bad tiles only"},{value:"good",text:"Good tiles only"}]}),e.addSelectOption({variable:"recorded_tile_colour",description:"Colour to highlight recorded tiles",options:this.coloursSelection,defaultValue:"c",inheritStyle:!0}),e.addSelectOption({variable:"bad_recorded_tile_colour",description:"Colour to highlight bad tiles",options:this.coloursSelection,defaultValue:"r",inheritStyle:!0,info:{title:"Bad Tile Recording and Highlighting",description:"This option enables recording of tiles when you encounter an NPC, colouring them differently to normal recorded tiles, and saving them separately."}}),e.addKeyDownOption({variable:"toggle_recording_keypress",description:"Start/stop recording",defaultValue:{code:82,key:"KeyR",description:"r"}});const s=t.addBox({heading:"Recorded Tiles",description:"The tiles that have been recorded."});s.setHTML(st.getRecordedOutputBoxHtml()),s.addAfterRefreshHook(()=>{this.recordedOutputAfterRefresh(s)}),e.addEventListener("save",()=>{s.setHTML(st.getRecordedOutputBoxHtml()),s.refreshElement()});const i=t.addBox({heading:"Record",description:"Start and stop recording."});i.setHTML(st.getRecordingToggleBoxHtml()),i.addAfterRefreshHook(()=>{this.recordingToggleAfterRefresh(i)})}static getRecordingToggleBoxHtml(){const t="-2px",e=`<img src="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0B%00%00%00%0D%08%03%00%00%00H%2Bd%09%00%00%00%7BPLTE%EF%00%01%DD%00%01%C5%00%01%B4%00%01%9A%00%01%95%00%01%88%00%01%7D%00%01%F9%00%00%F4%00%00%F4%01%00%EF%01%00%EE%00%00%DD%00%00%DD%01%00%CB%00%00%CB%01%00%C5%00%00%C5%01%00%BF%00%00%B4%00%00%B4%01%00%B3%00%00%9A%00%00%9A%01%00%99%00%00%95%00%00%88%00%00%88%01%00%7D%00%00%7D%01%00w%00%00v%00%00%FF%17%17%FF%18%18%FF--%FFpp%FFqq%FF%A3%A3%FF%FF%FF%FF%FF%FF%D1%8Fv%E3%00%00%00)tRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00R%F4%20%87%00%00%00wIDATx%DAT%8D%D1%0E%C2%20%14C%AB%E2%1C2D%C0%E1%B8%E8%04%99%C8%FF%7F%A1%98%18%8D%7D%3Ai%9A%1E%D4_%F0%CF1%D0%99.%F1%CDW%B6Y%2B%7D%F2%BB%8A%C8%AC%04%1F%A4%9Dn%08N%F6)%A7%FE0v%20%23%D2R%96%24%0C%C1%1Fy.%CF%92%F7j%02%E9%A1%F5%8F%BB%D0%F4%DD%CB1%20z%BB%12%1C%ED'%A2%CE%DE%19%A5%9D%9F%3F%5E%B6%ED%9A%F7%25%C0%00%C0~%0Ek%A4Y%8A%96%00%00%00%00IEND%AEB%60%82" style="vertical-align:${t};" alt="On blob created by Takius Stargazer" border="0">`;let s=`${`<img src="data:image/png,%89PNG%0D%0A%1A%0A%00%00%00%0DIHDR%00%00%00%0B%00%00%00%0D%08%03%00%00%00H%2Bd%09%00%00%00lPLTE%FF%FF%FF%D3%D3%D3%BB%BB%BB%9B%9B%9B%91%91%91%90%90%90%82%82%82%80%80%80~~~%7D%7D%7DuuullljjjgggbbbaaaUUUSSSMMMGGGDDD%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%2F%E3%EE%3C%00%00%00%16tRNS%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%00%01%D2%C0%E4%00%00%00_IDATx%DAT%8DI%0E%C0%20%0C%03%034%10%F6%00%E1%FF_-%B4%87R%9F%AC%915%86%F9%05%FE%5Dz%E3%D6e%F7%C1%25%C5TxL%10%CE%81%9C%0F%99%05z%0D%16%0D%DAP%3A%B4D%A8%95FJ%0D8%3A%A3%40%19%17yq%BF%F9%B5%F9%B9%7F%3D%F4x%96%BF.%7F%DD%FE%E3%F7%16%60%00%8E%9C%07%C8%8B%B1%7B%ED%00%00%00%00IEND%AEB%60%82" style="vertical-align:${t};" alt="Off bloc created by Takius Stargazer" border="0">`}&nbsp;Not recording`,i="Start recording";return c.getVariableValue("recording",!1)&&(s=`${e}&nbsp;<font color='red'>Recording</font>`,i="Stop recording"),`<tr><td><div><table width="100%"><tbody><tr><td width="1%" style="white-space: nowrap;">Recording status:</td><td><div id="pardus-flight-computer-recording-status">${s}</div></td><td align="right"><input type="button" value="${i}" id="pardus-flight-computer-record-button"></td></tr></tbody></table></div></td></tr>`}static getRecordedOutputBoxHtml(){let t=c.getVariableValue("recorded_tiles",[]).concat(c.getVariableValue("bad_recorded_tiles",[]).map(t=>`${t}|${c.getVariableValue("bad_recorded_tile_colour","r")}`)).join(",");return""===t&&(t="No tiles recorded"),`<tr><td><div><table width="100%"><tbody><tr><td colspan="3"><pre id="pardus-flight-computer-recording-output" style="padding: 5px; border-style: dashed; border-color: yellow; border-width: thin; white-space: pre-wrap; word-wrap: anywhere;">${t}</pre></td></tr><tr><td align="right" colspan="3"><input value="Clear" id="pardus-flight-computer-clear-recording-output" type="button"></td></tr></tbody></table></div></td></tr>`}recordingToggleAfterRefresh(t){document.getElementById("pardus-flight-computer-record-button").addEventListener("click",()=>{const e=c.getVariableValue("recording",!1);c.setVariableValue("recording",!e),t.setHTML(st.getRecordingToggleBoxHtml()),t.refreshElement()})}recordedOutputAfterRefresh(t){document.getElementById("pardus-flight-computer-clear-recording-output").addEventListener("click",()=>{c.setVariableValue("recorded_tiles",[]),c.setVariableValue("bad_recorded_tiles",[]),c.setVariableValue("expected_route",[]),t.setHTML(st.getRecordedOutputBoxHtml()),t.refreshElement()})}static getMapperBoxHtml(t=!1){const e=c.getVariableValue(t?"squads_tiles_to_highlight":"tiles_to_highlight","").split(","),s=[];for(const t of e)t&&s.push(t.split("|")[0]);const i=function(t=[]){const e=new Map;for(let s=0;s<t.length;s+=1){const i=a.getSectorForTile(t[s]).getTile(t[s]);if(i){const t=[];e.has(i.sector)&&t.push(...e.get(i.sector)),t.push(`${i.x},${i.y}`),e.set(i.sector,t)}else console.log(`No tile object for ${t[s]}`)}const s=new Map;for(const t of e)s.set(t[0],Z(t[0],t[1]));return s}(s);let o='<tr><td><div><table width="100%"><tbody>';for(const t of i)o+=`<tr><td>${t[0]}</td><td style="word-wrap: anywhere;"><a href="${t[1]}" target="_blank">${t[1]}</a></td></tr>`;return 0===i.size&&(o+="<tr><td>No sectors detected in the currently-stored route.</td></tr>"),o+="</tbody></table></div></td></tr>",o}}class it{#X=/([\w\-\d\s]*)\s\[(\d{1,3}),(\d{1,3})\]/;constructor(){const t=document.querySelector("b").innerText.match(this.#X),e=a.getTileIdFromSectorAndCoords(t[1],t[2],t[3]);this.tileId=e,this.#j(),this.#Y()}#Y(){document.getElementsByName("retreat")[0].addEventListener("click",()=>{this.#tt()})}#tt(){const t=userloc.toString(),e=c.getVariableValue("modify_route",!1),s=c.getVariableValue("modified_route",[]);e&&s[s.length-1]===t&&(s.pop(),c.setVariableValue("modified_route",s))}#j(){const t=c.getVariableValue("last_tile_id",-1),e=c.getVariableValue("expected_route",[]),s=userloc.toString(),i=c.getVariableValue("recording_mode","all"),o=c.getVariableValue("recording",!1),r=c.getVariableValue("modify_route",!1);if(-1!==t&&(o||r)){const t=new Set(c.getVariableValue("recorded_tiles",[])),a=new Set(c.getVariableValue("bad_recorded_tiles",[])),n=c.getVariableValue("modified_route",[]);if(e.includes(s)){for(const a of e){if(a===s)break;!o||"all"!==i&&"good"!==i||t.add(a),r&&!n.includes(a)&&n.push(a)}!o||"all"!==i&&"bad"!==i||(a.add(s),t.delete(s))}c.setVariableValue("bad_recorded_tiles",Array.from(a)),c.setVariableValue("recorded_tiles",Array.from(t)),c.setVariableValue("modified_route",n)}c.setVariableValue("expected_route",[]),c.setVariableValue("last_tile_id",this.tileId)}}class ot{constructor(){const t=new h;switch(document.location.pathname){case"/main.php":new tt(t.currentPage);break;case"/options.php":new st;break;case"/msgframe.php":new et;break;case"/ship2opponent_combat.php":new it;break;default:console.log(`Page '${document.location.pathname}' not implemented!`)}}}return e=e.default})());